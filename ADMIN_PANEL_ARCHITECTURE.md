# ğŸ“Š ADMIN PANEL - Architecture Visuelle

---

## ğŸ—ï¸ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Frontend (React)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  http://localhost:5173/admin                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚           AdminPanel.jsx (NEW)                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  Dashboard Stats                                â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  [100] [70] [20] [10] [5] [350]                â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  Search: [_______]  Filter: [All] [C] [I] [P] â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  User Table                                     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â” â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ ID â”‚ Name â”‚Email â”‚ Type â”‚ Subs â”‚KYC â”‚ Ban â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ 1  â”‚ John â”‚  ... â”‚ [C]â¬‡â”‚Activeâ”‚...â”‚ ğŸ”“  â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚    â”‚      â”‚      â””â”€[I] â”‚      â”‚    â”‚     â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚    â”‚      â”‚        [P]â”‚      â”‚    â”‚     â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ 2  â”‚ Jane â”‚  ... â”‚ [I]â¬‡â”‚Activeâ”‚...â”‚ ğŸ”’  â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚    â”‚      â”‚      â””â”€[C] â”‚      â”‚    â”‚     â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚    â”‚      â”‚        [P]â”‚      â”‚    â”‚     â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                              â”‚
â”‚  Styling: AdminPanel.css (NEW)                              â”‚
â”‚  â”œâ”€ Responsive Grid                                         â”‚
â”‚  â”œâ”€ Modern Design                                           â”‚
â”‚  â”œâ”€ Mobile Friendly                                         â”‚
â”‚  â””â”€ Accessible Components                                   â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†• API Calls
                        (fetch requests)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Backend (Express)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  http://localhost:3001/api/admin                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  admin.js (NEW) - Route Handler                       â”‚ â”‚
â”‚  â”‚                                                        â”‚ â”‚
â”‚  â”‚  GET /api/admin/check-auth                           â”‚ â”‚
â”‚  â”‚  â”œâ”€ Check ADMIN_MODE env var                         â”‚ â”‚
â”‚  â”‚  â”œâ”€ Check user roles                                 â”‚ â”‚
â”‚  â”‚  â””â”€ Return { isAdmin: bool }                         â”‚ â”‚
â”‚  â”‚                                                        â”‚ â”‚
â”‚  â”‚  GET /api/admin/users                                â”‚ â”‚
â”‚  â”‚  â”œâ”€ Query Prisma.user.findMany()                     â”‚ â”‚
â”‚  â”‚  â””â”€ Return { users: User[] }                         â”‚ â”‚
â”‚  â”‚                                                        â”‚ â”‚
â”‚  â”‚  GET /api/admin/users/:id                            â”‚ â”‚
â”‚  â”‚  â”œâ”€ Query Prisma.user.findUnique()                   â”‚ â”‚
â”‚  â”‚  â””â”€ Return { id, username, email, ... }             â”‚ â”‚
â”‚  â”‚                                                        â”‚ â”‚
â”‚  â”‚  PATCH /api/admin/users/:id/account-type â­ MAIN    â”‚ â”‚
â”‚  â”‚  â”œâ”€ Update user.accountType (Câ†’Iâ†’P)                 â”‚ â”‚
â”‚  â”‚  â”œâ”€ Update subscriptionType                          â”‚ â”‚
â”‚  â”‚  â”œâ”€ Update subscriptionStatus                        â”‚ â”‚
â”‚  â”‚  â””â”€ Return updated user                              â”‚ â”‚
â”‚  â”‚                                                        â”‚ â”‚
â”‚  â”‚  PATCH /api/admin/users/:id/subscription             â”‚ â”‚
â”‚  â”‚  â”œâ”€ Update subscriptionStatus                        â”‚ â”‚
â”‚  â”‚  â”œâ”€ Update subscription dates                        â”‚ â”‚
â”‚  â”‚  â””â”€ Return updated user                              â”‚ â”‚
â”‚  â”‚                                                        â”‚ â”‚
â”‚  â”‚  PATCH /api/admin/users/:id/ban                      â”‚ â”‚
â”‚  â”‚  â”œâ”€ Update user.isBanned                             â”‚ â”‚
â”‚  â”‚  â”œâ”€ Set bannedAt timestamp                           â”‚ â”‚
â”‚  â”‚  â”œâ”€ Set banReason (optional)                         â”‚ â”‚
â”‚  â”‚  â””â”€ Return updated user                              â”‚ â”‚
â”‚  â”‚                                                        â”‚ â”‚
â”‚  â”‚  GET /api/admin/stats                                â”‚ â”‚
â”‚  â”‚  â”œâ”€ Count totalUsers                                 â”‚ â”‚
â”‚  â”‚  â”œâ”€ Count by type (C, I, P)                          â”‚ â”‚
â”‚  â”‚  â”œâ”€ Count banned, reviews                            â”‚ â”‚
â”‚  â”‚  â””â”€ Return { totalUsers, amateurs, ... }            â”‚ â”‚
â”‚  â”‚                                                        â”‚ â”‚
â”‚  â”‚  Middleware: requireAdmin                            â”‚ â”‚
â”‚  â”‚  â”œâ”€ Check ADMIN_MODE=true (dev) OR                   â”‚ â”‚
â”‚  â”‚  â”œâ”€ Check user.roles.includes('admin') (prod)        â”‚ â”‚
â”‚  â”‚  â””â”€ Return 403 if neither                            â”‚ â”‚
â”‚  â”‚                                                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                              â”‚
â”‚  Integration:                                                â”‚
â”‚  â”œâ”€ server.js: import adminRoutes from './routes/admin'     â”‚
â”‚  â””â”€ server.js: app.use('/api/admin', adminRoutes)           â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†• Database Queries
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Database (PostgreSQL)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Prisma ORM                                                  â”‚
â”‚  â”œâ”€ User Model                                              â”‚
â”‚  â”‚  â”œâ”€ id (UUID)                                            â”‚
â”‚  â”‚  â”œâ”€ username                                             â”‚
â”‚  â”‚  â”œâ”€ email                                                â”‚
â”‚  â”‚  â”œâ”€ accountType: "consumer" | "influencer" | "producer" â”‚
â”‚  â”‚  â”œâ”€ subscriptionType                                     â”‚
â”‚  â”‚  â”œâ”€ subscriptionStatus                                   â”‚
â”‚  â”‚  â”œâ”€ isBanned (boolean)                                   â”‚
â”‚  â”‚  â”œâ”€ bannedAt (timestamp)                                 â”‚
â”‚  â”‚  â”œâ”€ banReason (string)                                   â”‚
â”‚  â”‚  â”œâ”€ roles (JSON array: ["admin", ...])                   â”‚
â”‚  â”‚  â””â”€ ... other fields                                     â”‚
â”‚  â”‚                                                          â”‚
â”‚  â””â”€ Indices                                                 â”‚
â”‚     â”œâ”€ accountType (for filtering)                          â”‚
â”‚     â”œâ”€ isBanned (for filtering)                             â”‚
â”‚     â””â”€ username, email (for search)                         â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   USER       â”‚
â”‚  (Admin)     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. Opens Admin Panel
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  /admin route in React   â”‚
â”‚  AdminPanel.jsx renders  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 2. Check Admin Access
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GET /api/admin/check-auth           â”‚
â”‚  â”œâ”€ requireAdmin middleware          â”‚
â”‚  â””â”€ Return { isAdmin: true }         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 3. Load Users & Stats
       â†“
       â”œâ”€â†’ GET /api/admin/users
       â”‚   â””â”€ Prisma: findMany()
       â”‚      â†“ Query DB
       â”‚      â† Return users array
       â”‚
       â””â”€â†’ GET /api/admin/stats
           â””â”€ Prisma: count()
              â†“ Query DB
              â† Return stats object
       â”‚
       â”œâ”€ Stats Display in Dashboard
       â””â”€ Users Display in Table
       â”‚
       â”‚ 4. User Changes Account Type
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Hover on Account Type Cell              â”‚
â”‚  See Quick Buttons: [C] [I] [P]          â”‚
â”‚  Click [I] (Influencer)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 5. Send Update to Backend
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PATCH /api/admin/users/:id/account-type â”‚
â”‚  Body: { accountType: "influencer" }    â”‚
â”‚  â”œâ”€ requireAdmin middleware              â”‚
â”‚  â”œâ”€ Validate accountType                 â”‚
â”‚  â”œâ”€ Update in Database:                  â”‚
â”‚  â”‚  â”œâ”€ user.accountType = "influencer"   â”‚
â”‚  â”‚  â”œâ”€ user.subscriptionType = "influencer" â”‚
â”‚  â”‚  â””â”€ user.subscriptionStatus = "active"   â”‚
â”‚  â””â”€ Return updated user                  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 6. Update Frontend Table
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Table refreshes                     â”‚
â”‚  Show new type: [I] for Influencer   â”‚
â”‚  âœ… Change displayed immediately     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 7. Test User Sees Effects
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Test User (Influencer now):         â”‚
â”‚  â”œâ”€ Refreshes page                   â”‚
â”‚  â”œâ”€ Frontend checks accountType      â”‚
â”‚  â”œâ”€ Shows Genetics section (new!)    â”‚
â”‚  â””â”€ âœ… Permissions updated           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Security Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Request to /api/admin/users        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  requireAdmin Middleware                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. Check ADMIN_MODE env variable        â”‚
â”‚     if (process.env.ADMIN_MODE === 'true')
â”‚        â””â”€ ALLOW (development)            â”‚
â”‚                                          â”‚
â”‚  2. Else check user authentication       â”‚
â”‚     if (!req.user)                       â”‚
â”‚        â””â”€ DENY (401)                     â”‚
â”‚                                          â”‚
â”‚  3. Check user has admin role            â”‚
â”‚     if (!req.user.roles.includes('admin'))
â”‚        â””â”€ DENY (403)                     â”‚
â”‚                                          â”‚
â”‚  4. All checks passed                    â”‚
â”‚     â””â”€ ALLOW (continue)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Execute Route Handler               â”‚
â”‚  Query Database                      â”‚
â”‚  Return Response                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š State Management

```
Frontend State (React):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  const [isAdmin, setIsAdmin] = ...   â”‚
â”‚  const [users, setUsers] = ...       â”‚
â”‚  const [stats, setStats] = ...       â”‚
â”‚  const [selectedUser, setSelected] ..â”‚
â”‚  const [filter, setFilter] = ...     â”‚
â”‚  const [searchQuery, setSearch] ...  â”‚
â”‚  const [loading, setLoading] = ...   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Backend State (Database):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User.accountType (Consumer/Inf/Pro) â”‚
â”‚  User.subscriptionType              â”‚
â”‚  User.subscriptionStatus            â”‚
â”‚  User.isBanned                      â”‚
â”‚  User.roles (["admin", ...])        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Session State:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  req.user (from Passport auth)      â”‚
â”‚  req.user.id                        â”‚
â”‚  req.user.accountType               â”‚
â”‚  req.user.roles                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Key Use Case: Change Account Type

```
SCENARIO: Admin wants to test Producer permissions

STEPS:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Admin opens /admin                              â”‚
â”‚    â†’ AdminPanel.jsx loads                          â”‚
â”‚    â†’ Fetches /api/admin/users                      â”‚
â”‚    â†’ Displays user table                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Admin finds test user "john_test" in table      â”‚
â”‚    Current: accountType = "consumer"               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Admin hovers over john_test's Account Type      â”‚
â”‚    Buttons appear: [C] [I] [P]                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Admin clicks [P] for Producer                   â”‚
â”‚    fetch("PATCH /api/admin/users/{id}/account-type"
â”‚         { accountType: "producer" })               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Backend processes request:                      â”‚
â”‚    - requireAdmin checks: âœ… Admin                 â”‚
â”‚    - Update DB: john_test.accountType = "producer" â”‚
â”‚    - Set subscriptionType = "producer"             â”‚
â”‚    - Return updated user                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. Frontend updates table immediately:            â”‚
â”‚    john_test now shows: [P] Producer               â”‚
â”‚    âœ… Visual confirmation                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. Test user logs in:                             â”‚
â”‚    - Backend loads john_test from DB              â”‚
â”‚    - accountType = "producer" â† NEW!              â”‚
â”‚    - Session updated                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. Test user navigates to /create/flower:         â”‚
â”‚    - Frontend checks: accountType === "producer"   â”‚
â”‚    - Shows: Genetics section âœ…                   â”‚
â”‚    - Shows: PhenoHunt section âœ…                  â”‚
â”‚    - Shows: Advanced pipelines âœ…                 â”‚
â”‚    â†’ V1 MVP Permission Verified âœ…                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

RESULT: Producer permissions working! âœ…
```

---

## ğŸ“ˆ Request/Response Examples

### Example 1: Get Users List

```javascript
// REQUEST
GET http://localhost:3001/api/admin/users
Headers: { }
(Authenticated user with admin role)

// RESPONSE (200 OK)
{
  "users": [
    {
      "id": "uuid-123",
      "username": "john_test",
      "email": "john@example.com",
      "accountType": "consumer",
      "subscriptionType": null,
      "subscriptionStatus": "inactive",
      "isBanned": false,
      "bannedAt": null,
      "kycStatus": null
    },
    {
      "id": "uuid-456",
      "username": "jane_producer",
      "email": "jane@example.com",
      "accountType": "producer",
      "subscriptionType": "producer",
      "subscriptionStatus": "active",
      "isBanned": false,
      "bannedAt": null,
      "kycStatus": "approved"
    }
  ]
}
```

### Example 2: Change Account Type

```javascript
// REQUEST
PATCH http://localhost:3001/api/admin/users/uuid-123/account-type
Headers: { "Content-Type": "application/json" }
Body: {
  "accountType": "producer"
}

// RESPONSE (200 OK)
{
  "id": "uuid-123",
  "username": "john_test",
  "email": "john@example.com",
  "accountType": "producer",          â† CHANGED!
  "subscriptionType": "producer",     â† CHANGED!
  "subscriptionStatus": "active",     â† CHANGED!
  "isBanned": false,
  "bannedAt": null,
  "kycStatus": null,
  "createdAt": "2025-01-15T...",
  "updatedAt": "2025-01-17T..."      â† CHANGED!
}
```

### Example 3: Get Statistics

```javascript
// REQUEST
GET http://localhost:3001/api/admin/stats

// RESPONSE (200 OK)
{
  "totalUsers": 150,
  "amateurs": 100,
  "influencers": 30,
  "producers": 20,
  "bannedUsers": 5,
  "totalReviews": 1250
}
```

---

## ğŸš€ Deployment Architecture

```
LOCAL DEVELOPMENT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Frontend:  npm run dev â†’ http://localhost:5173
Backend:   npm run dev â†’ http://localhost:3001
Database:  Local PostgreSQL (or Docker)
Auth Mode: ADMIN_MODE=true in .env


VPS PRODUCTION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Frontend:   React build â†’ nginx (static)
            https://vps-acc1787d/*
            
Backend:    Node.js â†’ PM2 (process manager)
            http://localhost:3001/*
            
Database:   PostgreSQL (managed)

Auth Mode:  No ADMIN_MODE, use role-based only
            Only users with "admin" role can access
```

---

**This architecture enables safe, fast, and repeatable testing of the V1 MVP compliance system.**
