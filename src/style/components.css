/* Harmonized components for Reviews-Maker
   Provides modal, button, card and small component overrides to align with the design tokens
   placed in `styles.css` and `ui/ui-base.css`.
*/
:root {
  /* Fallback tokens when needed */
  --rm-radius-xl: 22px;
  --rm-radius-lg: 14px;
  --rm-radius-md: 10px;
  --rm-radius-sm: 8px;
  --rm-ease: cubic-bezier(.2,.9,.2,1);
  --rm-modal-overlay: linear-gradient(180deg, rgba(1,7,18,0.64), rgba(1,7,18,0.88));
  --rm-modal-bg: linear-gradient(180deg, rgba(8,14,22,0.92), rgba(6,10,16,0.98));
  --rm-panel-border: rgba(148,163,184,0.06);
  /* fluid design tokens */
  --rm-fluid-padding: clamp(12px, 1.6vw, 28px);
  --rm-modal-maxwidth: clamp(640px, 48vw, 960px);
}

/* Global harmonization tweaks */
button, .btn, .pill-btn { font-family: inherit; font-weight:600; }

/* Primary / secondary / outline unified look */
.btn-primary, .btn.btn-primary {
  background: linear-gradient(90deg,var(--primary,#34d399),var(--accent,#38bdf8));
  color: #04202a;
  border: 0;
  box-shadow: 0 8px 30px rgba(2,6,23,0.45), 0 8px 24px rgba(56,189,248,0.06);
  transition: transform 180ms var(--rm-ease), box-shadow 180ms var(--rm-ease);
}
.btn-primary:hover { transform: translateY(-2px); box-shadow: 0 16px 40px rgba(2,6,23,0.5); }
.btn-secondary, .btn.btn-secondary {
  background: rgba(255,255,255,0.02);
  border: 1px solid var(--rm-panel-border);
}
.btn-outline { border: 1px solid rgba(148,163,184,0.06); background: transparent; }
.btn-ghost { background: transparent; border: 1px solid transparent; }

/* Pill buttons consistent */
.pill-btn { padding: 10px 16px; border-radius: 999px; gap:10px; }

/* Card & panel harmonization */
panel, .card, .library-item, .compact-library-item {
  border-radius: var(--rm-radius-lg);
  border: 1px solid var(--rm-panel-border);
  background: linear-gradient(180deg, rgba(10,18,34,0.6), rgba(6,12,18,0.6));
  box-shadow: 0 20px 60px rgba(2,6,23,0.48);
  min-width: 0;
}

/* Product type cards grid responsive */
.product-type-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: clamp(12px, 2vw, 32px);
  margin: clamp(18px, 3vw, 40px) auto clamp(18px, 3vw, 40px) auto;
  max-width: 900px;
  width: 100%;
}
.product-type-card {
  border-radius: 14px;
  background: linear-gradient(180deg, rgba(10,18,34,0.7), rgba(6,12,18,0.7));
  box-shadow: 0 8px 32px rgba(2,6,23,0.18);
  padding: clamp(18px, 3vw, 32px);
  min-width: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  transition: box-shadow 180ms var(--rm-ease), transform 180ms var(--rm-ease);
}
.product-type-card:hover {
  box-shadow: 0 16px 48px rgba(2,6,23,0.28);
  transform: translateY(-2px) scale(1.03);
}
.product-type-card img {
  width: clamp(32px, 6vw, 48px);
  height: clamp(32px, 6vw, 48px);
  margin-bottom: 12px;
}
.product-type-card h3 {
  font-size: clamp(1.1rem, 2vw, 1.3rem);
  margin: 0 0 6px 0;
}
.product-type-card p {
  font-size: clamp(0.92rem, 1.2vw, 1.05rem);
  color: var(--text-soft);
  margin: 0;
}

@media (max-width: 700px) {
  .product-type-grid {
    grid-template-columns: 1fr;
    gap: 16px;
    max-width: 98vw;
  }
  .product-type-card {
    padding: clamp(12px, 4vw, 22px);
  }
}

/* Gallery grid responsive */
.gallery-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: clamp(10px, 2vw, 24px);
  margin: clamp(12px, 2vw, 24px) auto;
  width: 100%;
  max-width: 900px;
}
.gallery-item {
  border-radius: 12px;
  background: linear-gradient(180deg, rgba(10,18,34,0.7), rgba(6,12,18,0.7));
  box-shadow: 0 4px 16px rgba(2,6,23,0.12);
  padding: clamp(10px, 2vw, 18px);
  min-width: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
}
.gallery-item img {
  width: 100%;
  max-width: 160px;
  border-radius: 10px;
  margin-bottom: 8px;
}

/* Stat cards more compact and uniform */
.stat-card { padding: 10px 12px; min-width:72px; border-radius:12px; background:rgba(255,255,255,0.02); }
.stat-card .num { font-size:1.05rem; color:var(--text); }

/* Unified modal styles (stacking & interaction fixes)
   Use fixed positioning for modals to ensure overlays sit behind the modal
   content and to avoid invisible overlays stealing pointer events. */
.modal {
  position: fixed;
  inset: 0;
  display: none; /* toggled via .show */
  align-items: center;
  justify-content: center;
  pointer-events: none; /* disabled when hidden */
}
.modal.show {
  display: flex;
  pointer-events: auto;
}
.modal-overlay {
  background: var(--rm-modal-overlay);
  backdrop-filter: blur(8px);
  position: absolute;
  inset: 0;
  z-index: 10040; /* under modal content */
}
.modal-content {
  /* Use fluid max width and padding so modal scales gracefully */
  width: min(var(--rm-modal-maxwidth), calc(100% - 56px));
  max-width: var(--rm-modal-maxwidth);
  max-height: 86vh;
  padding: var(--rm-fluid-padding);
  border-radius: var(--rm-radius-lg);
  border: 1px solid var(--rm-panel-border);
  background: var(--rm-modal-bg);
  box-shadow: 0 30px 80px rgba(2,6,23,0.6);
  position: relative;
  z-index: 10060; /* above overlay */
  overflow: hidden;
}
/* Fallback centering: ensure the dialog box is centered inside fixed modal
   even if some layout rules interfere. Using transform centering avoids
   reliance on flex in edge cases. */
.modal.show .modal-content { transform: translateY(0); }
.modal .modal-content { margin: 0 auto; }
.modal-content.centered {
  /* Use absolute positioning so top/left:50% centers the dialog
     inside the fixed-positioned .modal container. Relative positioning
     was shifting the dialog incorrectly in some layouts (transformed
     ancestors / flex containers), causing it to appear off-center.
  */
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  margin: 0; /* ensure no extra offset from margins */
  max-height: 86vh; /* keep the same max-height behavior as the modal */
}

/* Entrance animation for modals */
@keyframes rm-modal-fade {
  from { opacity: 0; transform: translateY(-6px) scale(0.995); }
  to   { opacity: 1; transform: translateY(0) scale(1); }
}

.modal.show { animation: rm-modal-fade 180ms var(--rm-ease) both; }

/* Improve modal content visuals and ergonomics */
.modal-content {
  transition: transform 180ms var(--rm-ease), opacity 160ms ease;
  border-radius: 14px;
  box-sizing: border-box;
  overflow: hidden;
  /* Slightly smaller footprint so underlying content remains visible */
  width: min(var(--rm-modal-maxwidth), calc(100% - 96px));
  max-height: 84vh;
}

/* When content is taller than viewport allow internal scrolling while keeping header visible */
.modal-content .modal-body {
  max-height: calc(86vh - 120px);
  overflow: auto;
  padding-right: 8px; /* space for scrollbar */
  padding-left: 6px;
  padding-bottom: 8px;
}

/* Bigger, more accessible close button */
.modal-close { padding: 8px; border-radius: 10px; font-size: 1.05rem; }

/* Desktop: keep centered dialog absolute; Mobile: switch to sheet-style */
@media (max-width: 880px) {
  .modal-content.centered {
    position: relative; /* sheet style inside modal */
    top: auto;
    left: auto;
    transform: none;
    width: calc(100% - 28px);
    max-height: 92vh;
    margin: 0 auto;
    border-radius: 12px;
  }
  .modal { align-items: flex-end; padding: 12px; }
}

/* Sheet mode for tall modals on larger viewports. When JS detects the
   content is taller than available viewport space we switch to .modal.sheet
   so the dialog pins to the bottom and becomes scrollable internally.
*/
.modal.sheet { align-items: flex-end !important; padding: 12px !important; }
.modal.sheet .modal-content { position: relative !important; width: min(920px, calc(100% - 48px)); max-height: 92vh !important; border-radius: 12px; transform: none !important; margin: 0 auto; }
.modal.sheet .modal-body, .modal.sheet .account-modal-inner { max-height: calc(92vh - 120px); overflow: auto; }

/* Desktop: leave a small top margin so header doesn't sit flush to viewport top */
@media (min-width: 881px) {
  /* Desktop: modal centrÃ©, largeur max, overlay full */
  .modal { align-items: center !important; justify-content: center !important; padding: 0 !important; }
  #accountModal .modal-content, .account-modal-content {
    position: absolute !important;
    left: 50% !important;
    top: 50% !important;
    transform: translate(-50%, -50%) !important;
    max-width: 420px !important;
    width: 100% !important;
    min-width: 320px !important;
    border-radius: 18px !important;
    padding: clamp(22px, 3vw, 36px) !important;
    box-shadow: 0 24px 80px rgba(2,6,23,0.32);
    margin: 0 !important;
    overflow: hidden !important;
    display: flex;
    flex-direction: column;
  }
  #accountModal .modal-header, .account-header {
    position: sticky;
    top: 0;
    background: inherit;
    z-index: 2;
    padding-bottom: 10px;
    border-bottom: 1px solid rgba(148,163,184,0.06);
  }
  .modal-overlay {
    position: fixed !important;
    inset: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    z-index: 10060 !important;
  }
}

@media (max-width: 880px) {
  /* Mobile: bottom sheet, full width, arrondi haut */
  #accountModal .modal-content, .account-modal-content {
    position: fixed !important;
    left: 50% !important;
    bottom: 0 !important;
    top: auto !important;
    transform: translateX(-50%) !important;
    width: 100vw !important;
    max-width: 100vw !important;
    min-width: 0 !important;
    border-radius: 18px 18px 0 0 !important;
    padding: clamp(14px, 5vw, 22px) !important;
    box-shadow: 0 -4px 40px rgba(2,6,23,0.22);
    margin: 0 !important;
    overflow: hidden !important;
    display: flex;
    flex-direction: column;
  }
  #accountModal .modal-header, .account-header {
    position: sticky;
    top: 0;
    background: inherit;
    z-index: 2;
    padding-bottom: 8px;
    border-bottom: 1px solid rgba(148,163,184,0.06);
  }
  .modal-overlay {
    position: fixed !important;
    inset: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    z-index: 10060 !important;
  }
}

/* Focus styles inside modal for keyboard users */
.modal:focus { outline: none; }
.modal-content :where(button, a, input, textarea, [tabindex]) :focus {
  outline: 3px solid rgba(52,211,153,0.14);
  outline-offset: 2px;
}

/* Subtle drop shadow for overlay to separate modal from page */
.modal-overlay { box-shadow: inset 0 0 0 1px rgba(255,255,255,0.02); }

/* Account dialog: allow internal scrolling so content isn't clipped */
.account-dialog {
  overflow: auto !important;
  max-height: calc(86vh);
  -webkit-overflow-scrolling: touch;
  padding: 6px 0;
}

/* Specific visual polish for Account modal */
#accountModal .modal-content,
.account-modal-content,
.account-dialog {
  width: min(800px, calc(100% - 48px));
  max-height: 84vh;
  display: flex;
  flex-direction: column;
  padding: 0; /* header/body control padding separately */
  border-radius: 16px;
  background: rgba(6,10,12,0.98); /* near-opaque to avoid heavy double overlay */
  border: 1px solid rgba(148,163,184,0.04);
  box-shadow: 0 30px 80px rgba(2,6,23,0.6);
  z-index: 10070; /* ensure account modal sits above other modal content */
}

#accountModal .modal-header, .account-header {
  padding: 16px 18px;
  align-items: center;
  gap: 12px;
  flex: 0 0 auto; /* keep header fixed */
}

/* Account modal specific: contain scroll and avoid horizontal overflow */
#accountModal .modal-content, .account-modal-content { overflow: hidden; }
#accountModal .modal-body, .account-modal-inner {
  overflow: auto;
  padding: 14px;
  flex: 1 1 auto; /* take remaining height */
}

.account-header .title { font-size:1.18rem; font-weight:700; color:var(--text); }
.account-header .controls { display:flex; gap:10px; align-items:center; }

/* Header settings button styling */
#accountModal #openAccountSettings, #accountModal .btn-ghost, .account-header .btn-ghost {
  background: transparent;
  border: 1px solid rgba(148,163,184,0.06);
  padding:8px 12px;
  border-radius:10px;
  color:var(--text);
}
#accountModal #openAccountSettings:hover { background: rgba(255,255,255,0.02); }

/* Modal body grid and panels */
.account-body {
  display:grid;
  grid-template-columns: clamp(220px, 26%, 340px) 1fr;
  gap: clamp(10px, 2.2vw, 22px);
  padding: clamp(12px, 1.6vw, 20px);
}
.account-left { padding: 14px; }
.account-right { padding: 14px; }

/* Avatar and meta */
.account-avatar { width:clamp(44px, 4.2vw, 72px); height:clamp(44px, 4.2vw, 72px); border-radius:12px; font-size:22px; }

/* Override reference avatar sizes from styles.css to scale down on narrow viewports */
@media (max-width: 760px) {
  .account-avatar { width: clamp(40px, 8vw, 56px) !important; height: clamp(40px, 8vw, 56px) !important; }
}
.account-meta .email { font-weight:700; font-size:0.95rem; }
.account-meta .sub { font-size:0.88rem; color:var(--text-soft); }

/* Stat cards: subtle elevation and spacing */
.stat-card { padding: clamp(8px,1.2vw,14px) clamp(10px,1.4vw,14px); border-radius:10px; background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00)); border:1px solid rgba(255,255,255,0.02); }
.stat-card .num { font-size:1.15rem; }

/* Actions panel */
.account-right .panel { padding: 12px; }
.account-right .action-list { display:flex; gap:10px; flex-wrap:wrap; }
.account-right .action-list .btn { padding:8px 12px; }

/* Preferences panel */
.account-preferences { padding:12px; }

/* Scrollbar inside modal (subtle) */
.account-dialog::-webkit-scrollbar, .modal-content::-webkit-scrollbar { width: 10px; }
.account-dialog::-webkit-scrollbar-track, .modal-content::-webkit-scrollbar-track { background: rgba(6,8,12,0.6); border-radius:999px; }
.account-dialog::-webkit-scrollbar-thumb, .modal-content::-webkit-scrollbar-thumb { background: rgba(148,163,184,0.18); border-radius:999px; }

/* Mobile: full width sheet for comfortable reading */
@media (max-width:880px) {
  #accountModal .modal-content, .account-modal-content { width: calc(100% - 24px); border-radius: 12px; }
  .account-body { grid-template-columns: 1fr; }
}

/* When a modal is open, force only the shown modal to be interactive */
/* Do not use a global body.modal-open pointer-events rule: it can block
  overlays or nested modals. Each modal controls its own pointer-events via
  the .modal and .modal.show rules above. */
.modal:not(.show) { pointer-events: none; }
.modal-header { display:flex; align-items:center; justify-content:space-between; gap:12px; padding-bottom:8px; border-bottom:1px solid rgba(148,163,184,0.03); }
.modal-header h2, .modal-header h3 { margin:0; font-size:1.15rem; }
.modal-close { background:transparent; border:0; color:var(--text-muted); padding:6px; border-radius:8px; }
.modal-close:hover { color:var(--text); background: rgba(255,255,255,0.02); }

/* Public profile specific tweaks */
#publicProfileModal .account-profile, #accountModal .account-profile { display:flex; gap:12px; align-items:center; }
#publicProfileModal .account-avatar, #accountModal .account-avatar { width:48px; height:48px; border-radius:12px; display:grid; place-items:center; background:rgba(255,255,255,0.03); }

/* Ensure owner settings button is visually elevated */
#publicProfileModal .btn-ghost, #publicProfileModal .btn { border-radius:10px; }
#publicProfileModal #publicProfileSettingsBtn { display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:12px; }

/* Library cards compacter and uniform */
.compact-library-list .compact-library-item { padding:14px; border-radius:14px; border:1px solid rgba(148,163,184,0.04); background: linear-gradient(180deg, rgba(8,14,22,0.36), rgba(6,10,16,0.28)); }
.compact-library-list .compact-library-item .title { font-weight:700; margin-bottom:6px; }

/* Editor form inputs and panels */
.review-form .form-content { background: transparent; }
.input, input[type="text"], textarea { background: rgba(10,18,34,0.5); border: 1px solid var(--rm-panel-border); padding:10px 12px; border-radius:10px; color:var(--text); }
.input:focus, textarea:focus { box-shadow: 0 8px 30px rgba(52,211,153,0.08); outline:none; }

/* Quick visual for segmented privacy control */
.segmented button { padding:8px 12px; border-radius:10px; }
.segmented button[aria-pressed="true"] { background: linear-gradient(90deg,var(--primary,#34d399),var(--accent,#38bdf8)); color:#04202a; }

/* Floating auth button alignment */
.floating-auth-btn { right:clamp(12px,2.2vw,36px); bottom:clamp(12px,2.2vw,36px); box-shadow:0 14px 40px rgba(2,6,23,0.6); }

/* Accessibility: visible focus ring for keyboard users */
button:focus, .input:focus, .modal-close:focus { outline: 3px solid rgba(52,211,153,0.14); }

/* Mobile tweaks */
@media (max-width:700px) {
  .modal-content { width: calc(100% - 28px); border-radius: 12px; }
  .top-nav { padding: 12px; }
}
/* components.css - component-specific rules */
.profile-stats .stats-grid{display:flex;gap:12px}
.stat-card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:12px;border-radius:10px}
.account-stats-by-type{display:flex;gap:8px;flex-wrap:wrap}

/* Responsive small thumbnail used in lists */
.rm-thumb { width: clamp(36px, 6.2vw, 56px); height: clamp(36px, 6.2vw, 56px); border-radius: 8px; overflow: hidden; border: 1px solid var(--glass-border); display:inline-grid; vertical-align:middle; }
.rm-thumb img { width:100%; height:100%; object-fit:cover; display:block; }

/* Ensure titles with thumbs align nicely */
.meta .title { display:flex; align-items:center; gap: clamp(8px, 1.2vw, 12px); }

/* Override legacy rules in styles.css that forcibly hide #publicProfileModal
   Ensure the public profile modal follows the .modal/.modal.show flex behavior */
#publicProfileModal { display: none !important; visibility: hidden !important; }
#publicProfileModal.show {
  display: flex !important;
  visibility: visible !important;
  align-items: center;
  justify-content: center;
}

/* Public profile is preview-only: hide its dark backdrop so only the modal content shows */
#publicProfileModal .modal-overlay,
#publicProfileOverlay {
  display: none !important;
  background: transparent !important;
  pointer-events: none !important;
}

/* Strong overrides to make components.css authoritative for modal visuals
   These rules deliberately use higher specificity to neutralize legacy files
   (styles.css and src/style/base.css) that define other modal defaults. */
body .modal { position: fixed !important; inset: 0 !important; display: none !important; align-items: center !important; justify-content: center !important; }
body .modal.show { display: flex !important; pointer-events: auto !important; }
/* Ensure overlay fully covers viewport and sits above legacy UI */
/* Make overlay sit *below* modal-content but above page UI.
  Use a high but reasonable z-index to avoid stomping on other global
  elements (some legacy rules used astronomically high values).
  Also prefer fixed positioning so orphan overlays cannot appear in
  odd locations due to parent stacking contexts. */
body .modal-overlay { position: fixed !important; inset: 0 !important; width: 100% !important; height: 100% !important; background: var(--rm-modal-overlay) !important; backdrop-filter: blur(8px) !important; z-index: 10060 !important; }
/* Keep modal content above the overlay */
/* Keep modal content above the overlay but below transient UI like toasts
  that may want to appear above modals. Use conservative z-index values. */
body .modal-content { position: relative !important; z-index: 10070 !important; }

/* Ensure preview-only modals or those explicitly hidden via helper will not show an overlay */
.modal.preview-only .modal-overlay, .modal[data-backdrop="none"] .modal-overlay { display: none !important; pointer-events: none !important; background: transparent !important; }

/* Ensure overlays are only visible when their modal is explicitly shown.
  This prevents orphaned overlay elements (left in the DOM or created
  programmatically) from appearing as small grey blocks in the viewport.
*/
body .modal:not(.show) > .modal-overlay { display: none !important; visibility: hidden !important; pointer-events: none !important; }
body .modal.show > .modal-overlay { display: block !important; visibility: visible !important; pointer-events: auto !important; }
.modal-overlay:not(.show) { display: none !important; }

/* Defensive: if preview elements end up without the `hidden` attribute,
  force them hidden unless explicitly opened via script. This avoids the
  small grey preview panel showing in the top-left when not in use. */
#previewOverlay[hidden], #previewModal[hidden] { display: none !important; visibility: hidden !important; opacity: 0 !important; pointer-events: none !important; }

/* Position account modal slightly higher than center so the full dialog
  header is visible on typical laptop viewports and users don't have to
  scroll immediately. Keep mobile/sheet behavior intact. */
#accountModal .modal-content.centered { /* subtle upward shift */
  /* Move slightly higher on most laptop screens but stay flexible for
     very short viewports (phones). The JS helper sets --rm-account-offset
     when necessary; keep this as a gentle default uplift. */
  top: calc(40% + var(--rm-account-offset, 0)) !important;
  transform: translate(-50%, -50%) !important;
  /* cap width so the dialog does not become overly large on wide screens */
  max-width: 820px; width: min(820px, calc(100% - 56px));
}

/* In case an overlay was accidentally inserted outside a modal, ensure
  any standalone .modal-overlay can't appear above the UI unless it has
  an explicit .show class and belongs to a shown modal. */
.modal-overlay { box-sizing: border-box; }

/* Defensive: hide any tiny orphan preview panels that sometimes remain
   visible in the top-left due to legacy scripts inserting DOM fragments.
   This targets very small overlays/modal fragments so we don't hide
   legitimate full-screen modals. */
.modal-overlay[style*="width: 1px"], .modal-overlay[style*="height: 1px"], .modal-overlay[style*="left: 0px; top: 0px; width: 100px; height: 100px"] {
  display: none !important; visibility: hidden !important; pointer-events: none !important;
}

