/* Harmonized components for Reviews-Maker
   Provides modal, button, card and small component overrides to align with the design tokens
   placed in `styles.css` and `ui/ui-base.css`.
*/
:root {
  /* Fallback tokens when needed */
  --rm-radius-xl: 22px;
  --rm-radius-lg: 14px;
  --rm-radius-md: 10px;
  --rm-radius-sm: 8px;
  --rm-ease: cubic-bezier(.2,.9,.2,1);
  --rm-modal-overlay: linear-gradient(180deg, rgba(1,7,18,0.64), rgba(1,7,18,0.88));
  --rm-modal-bg: linear-gradient(180deg, rgba(8,14,22,0.92), rgba(6,10,16,0.98));
  --rm-panel-border: rgba(148,163,184,0.06);
  /* fluid design tokens */
  --rm-fluid-padding: clamp(12px, 1.6vw, 28px);
  --rm-modal-maxwidth: clamp(640px, 48vw, 960px);
}

/* Global harmonization tweaks */
button, .btn, .pill-btn { font-family: inherit; font-weight:600; }

/* Primary / secondary / outline unified look */
.btn-primary, .btn.btn-primary {
  background: linear-gradient(90deg,var(--primary,#34d399),var(--accent,#38bdf8));
  color: #04202a;
  border: 0;
  box-shadow: 0 8px 30px rgba(2,6,23,0.45), 0 8px 24px rgba(56,189,248,0.06);
  transition: transform 180ms var(--rm-ease), box-shadow 180ms var(--rm-ease);
}
.btn-primary:hover { transform: translateY(-2px); box-shadow: 0 16px 40px rgba(2,6,23,0.5); }
.btn-secondary, .btn.btn-secondary {
  background: rgba(255,255,255,0.02);
  border: 1px solid var(--rm-panel-border);
}
.btn-outline { border: 1px solid rgba(148,163,184,0.06); background: transparent; }
.btn-ghost { background: transparent; border: 1px solid transparent; }

/* Pill buttons consistent */
.pill-btn { padding: 10px 16px; border-radius: 999px; gap:10px; }

/* Card & panel harmonization */
panel, .card, .library-item, .compact-library-item {
  border-radius: var(--rm-radius-lg);
  border: 1px solid var(--rm-panel-border);
  background: linear-gradient(180deg, rgba(10,18,34,0.6), rgba(6,12,18,0.6));
  box-shadow: 0 20px 60px rgba(2,6,23,0.48);
  min-width: 0;
}

/* Product type cards grid responsive */
.product-type-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  max-width: 900px;
  width: 100%;
}
.product-type-card img {
  width: clamp(32px, 6vw, 48px);
  height: clamp(32px, 6vw, 48px);
    z-index: 10070; /* ensure account modal sits above other modal content */
    border-radius: var(--rm-radius-xl);
    box-shadow: 0 36px 120px rgba(2,6,23,0.7), 0 10px 30px rgba(56,189,248,0.03);
    border: 1px solid rgba(255,255,255,0.03);
}
.product-type-card h3 {
  font-size: clamp(1.1rem, 2vw, 1.3rem);
  margin: 0 0 6px 0;
}
.product-type-card p {
  font-size: clamp(0.92rem, 1.2vw, 1.05rem);
  color: var(--text-soft);
  margin: 0;
}

@media (max-width: 700px) {
  .product-type-grid {
    grid-template-columns: 1fr;
    gap: 16px;
    max-width: 98vw;
  }
  .product-type-card {
    padding: clamp(12px, 4vw, 22px);
  }
}

/* Gallery grid responsive */
.gallery-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: clamp(10px, 2vw, 24px);
  margin: clamp(12px, 2vw, 24px) auto;
  width: 100%;
  max-width: 900px;
}
.gallery-item {
  border-radius: 12px;
  background: linear-gradient(180deg, rgba(10,18,34,0.7), rgba(6,12,18,0.7));
  box-shadow: 0 4px 16px rgba(2,6,23,0.12);
  padding: clamp(10px, 2vw, 18px);
  min-width: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
}
.gallery-item img {
  width: 100%;
  max-width: 160px;
  border-radius: 10px;
  margin-bottom: 8px;
}

/* Stat cards more compact and uniform */
.stat-card { padding: 10px 12px; min-width:72px; border-radius:12px; background:rgba(255,255,255,0.02); }
.stat-card .num { font-size:1.05rem; color:var(--text); }

/* Unified modal styles (stacking & interaction fixes)
   Use fixed positioning for modals to ensure overlays sit behind the modal
   content and to avoid invisible overlays stealing pointer events. */
.modal {
  position: fixed;
  inset: 0;
  display: none; /* toggled via .show */
  align-items: center;
  justify-content: center;
  pointer-events: none; /* disabled when hidden */
  /* ensure modal is topmost stacking context for consistent centering */
  z-index: 10050;
  padding: 20px; /* keep some breathing room on small viewports */
  box-sizing: border-box;
}
.modal.show {
  display: flex;
  pointer-events: auto;
}
.modal-overlay {
  background: var(--rm-modal-overlay);
  backdrop-filter: blur(8px);
  position: absolute;
  inset: 0;
  z-index: 10040; /* under modal content */
}
.modal-content {
  /* Use fluid max width and padding so modal scales gracefully */
  width: min(var(--rm-modal-maxwidth), calc(100% - 56px));
  max-width: var(--rm-modal-maxwidth);
  max-height: 86vh;
  padding: var(--rm-fluid-padding);
  border-radius: var(--rm-radius-lg);
  border: 1px solid var(--rm-panel-border);
  background: var(--rm-modal-bg);
  box-shadow: 0 30px 80px rgba(2,6,23,0.6);
  position: relative; /* keep content positioned inside the fixed .modal */
  z-index: 10060; /* above overlay */
  overflow: hidden;
  margin: 0 auto; /* center when possible */
  max-width: calc(var(--rm-modal-maxwidth));
}
/* Fallback centering: ensure the dialog box is centered inside fixed modal
   even if some layout rules interfere. Using transform centering avoids
   reliance on flex in edge cases. */
.modal.show .modal-content { transform: translateY(0); }
.modal .modal-content { margin: 0 auto; }
.modal-content.centered {
  /* Prefer transform centering but keep element relative to the modal
     container. Absolute centering creates issues when ancestor transforms
     or flexbox are present; use relative + transform when possible. */
  position: relative;
  top: auto;
  left: auto;
  transform: none;
  margin: 0 auto;
  max-height: 86vh;
}

/* Entrance animation for modals */
@keyframes rm-modal-fade {
  from { opacity: 0; transform: translateY(-6px) scale(0.995); }
  to   { opacity: 1; transform: translateY(0) scale(1); }
}

.modal.show { animation: rm-modal-fade 180ms var(--rm-ease) both; }

/* Improve modal content visuals and ergonomics */
.modal-content {
  transition: transform 180ms var(--rm-ease), opacity 160ms ease;
  border-radius: 14px;
  box-sizing: border-box;
  overflow: hidden;
  /* Slightly smaller footprint so underlying content remains visible */
  width: min(var(--rm-modal-maxwidth), calc(100% - 96px));
  max-height: 84vh;
}

/* When content is taller than viewport allow internal scrolling while keeping header visible */
.modal-content .modal-body {
  max-height: calc(86vh - 120px);
  overflow: auto;
  padding-right: 8px; /* space for scrollbar */
  padding-left: 6px;
  padding-bottom: 8px;
}

/* Bigger, more accessible close button */
.modal-close { padding: 8px; border-radius: 10px; font-size: 1.05rem; }

/* Force centered dialog for all viewports */
.modal { align-items: center !important; justify-content: center !important; }
.modal-content.centered {
  /* Ensure centered content uses relative centering inside the flex modal.
     This avoids unexpected offsets when other CSS forced absolute layout. */
  position: relative;
  top: auto;
  left: auto;
  transform: none;
  margin: 0 auto;
}

/* Sheet mode for tall modals on larger viewports. When JS detects the
   content is taller than available viewport space we switch to .modal.sheet
   so the dialog pins to the bottom and becomes scrollable internally.
*/
/* Remove sheet mode — center modals instead */
.modal.sheet { --rm-sheet-disabled: 1; }
.modal.sheet .modal-content { box-sizing: border-box; }

/* Desktop: leave a small top margin so header doesn't sit flush to viewport top */
/* Account modal sizing — keep centered and sized for desktop
   Remove forced absolute positioning which can be broken by transformed ancestors
   and instead rely on the fixed .modal container (+ flex) to center content. */
#accountModal .modal-content, .account-modal-content {
  position: relative !important;
  left: auto !important;
  top: auto !important;
  transform: none !important;
  max-width: 640px !important;
  width: 100% !important;
  min-width: 320px !important;
  border-radius: 18px !important;
  padding: clamp(18px, 2.5vw, 30px) !important;
  box-shadow: 0 24px 80px rgba(2,6,23,0.32);
  margin: 0 auto !important;
  overflow: hidden !important;
  display: flex;
  flex-direction: column;
}
#accountModal .modal-header, .account-header {
  position: sticky;
  top: 0;
  background: inherit;
  z-index: 2;
  padding-bottom: 10px;
  border-bottom: 1px solid rgba(148,163,184,0.06);
}
.modal-overlay {
  position: fixed !important;
  inset: 0 !important;
  width: 100vw !important;
  height: 100vh !important;
  z-index: 10060 !important;
}

/* Hide global overlays when account modal specifically requests no backdrop
   or when the page is in the account-modal-open state. This prevents
   overlays from sitting above inputs or stacking behind other dialogs. */
#accountModal[data-backdrop="none"] + .account-dialog,
#accountModal[data-backdrop="none"] .account-dialog,
body.account-modal-open .modal-overlay,
body.account-modal-open .account-overlay {
  display: none !important;
  visibility: hidden !important;
  opacity: 0 !important;
  pointer-events: none !important;
}

/* If account modal markup uses a `.modal` wrapper with an internal .modal-overlay,
   hide that overlay specifically when the account modal requests no backdrop. */
#accountModal[data-backdrop="none"] .modal-overlay {
  display: none !important;
  visibility: hidden !important;
  opacity: 0 !important;
  pointer-events: none !important;
}

/* Ensure account dialog visually sits above everything and has rounded corners */
.account-dialog, .account-modal-content {
  border-radius: var(--rm-radius-lg) !important;
  z-index: 10070 !important;
}

/* Aggressive override: when account modal is active, hide any overlay elements
   that could dim the editor or sit above input fields. This covers legacy
   modal-overlay/account-overlay/preview-overlay variants and modal wrappers
   that use data-backdrop="none". Use very high specificity and !important
   to neutralize other styles from older CSS files. */
body.account-modal-open .modal-overlay,
body.account-modal-open .account-overlay,
body.account-modal-open #previewOverlay,
body.account-modal-open .preview-overlay,
#accountModal[data-backdrop="none"] .modal-overlay,
#accountModal[data-backdrop="none"] .account-overlay,
.modal[data-backdrop="none"] .modal-overlay {
  display: none !important;
  visibility: hidden !important;
  opacity: 0 !important;
  pointer-events: none !important;
  background: transparent !important;
}

/* Make sure account dialog children are interactive (pointer-events may have
   been disabled by global modal rules). Only enable when account modal is open. */
body.account-modal-open #accountModal .account-dialog,
body.account-modal-open #accountModal .account-dialog *,
#accountModal.show .account-dialog,
#accountModal.show .account-dialog * {
  pointer-events: auto !important;
}

/* Highest-specificity safety net to beat rules in styles.css which set
   `.account-overlay`/`#accountModal` visibility. This targets the exact
   DOM shape used by the app and only applies when the account modal body
   class is present or when the modal explicitly requests no backdrop. */
html body.account-modal-open #accountModal > .account-overlay,
html #accountModal[data-backdrop="none"] > .account-overlay,
html body.account-modal-open .modal-overlay,
html #accountModal[data-backdrop="none"] .modal-overlay {
  display: none !important;
  visibility: hidden !important;
  opacity: 0 !important;
  pointer-events: none !important;
  background: transparent !important;
}

/* Mobile adjustments: keep centered but fit screen */
@media (max-width: 880px) {
  .modal:not(.centered-modal) .modal-content.centered { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: calc(100% - 32px); }
  .account-body { grid-template-columns: 1fr; }
}

/* Focus styles inside modal for keyboard users */
.modal:focus { outline: none; }
.modal-content :where(button, a, input, textarea, [tabindex]) :focus {
  outline: 3px solid rgba(52,211,153,0.14);
  outline-offset: 2px;
}

/* Subtle drop shadow for overlay to separate modal from page */
.modal-overlay { box-shadow: inset 0 0 0 1px rgba(255,255,255,0.02); }

/* Account dialog: allow internal scrolling so content isn't clipped */
.account-dialog {
  overflow: auto !important;
  max-height: calc(86vh);
  -webkit-overflow-scrolling: touch;
  padding: 6px 0;
}

/* Specific visual polish for Account modal */
#accountModal .modal-content,
.account-modal-content,
.account-dialog {
  width: min(800px, calc(100% - 48px));
  max-height: 84vh;
  display: flex;
  flex-direction: column;
  padding: 0; /* header/body control padding separately */
  border-radius: 16px;
  background: rgba(6,10,12,0.98); /* near-opaque to avoid heavy double overlay */
  border: 1px solid rgba(148,163,184,0.04);
  box-shadow: 0 30px 80px rgba(2,6,23,0.6);
  z-index: 10070; /* ensure account modal sits above other modal content */
}

#accountModal .modal-header, .account-header {
  padding: 16px 18px;
  align-items: center;
  gap: 12px;
  flex: 0 0 auto; /* keep header fixed */
}

/* Account modal centering: rely on the base .modal flex centering. These
   rules keep high specificity but remove absolute transforms which can be
   broken by DOM layout / transformed ancestors. */
#accountModal.show, .centered-modal#accountModal, .centered-modal {
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
}
#accountModal.show .modal-content, .centered-modal#accountModal .modal-content, .centered-modal .modal-content {
  position: relative !important;
  left: auto !important;
  top: auto !important;
  transform: none !important;
  margin: 0 auto !important;
}

/* Account modal specific: contain scroll and avoid horizontal overflow */
#accountModal .modal-content, .account-modal-content { overflow: hidden; }
#accountModal .modal-body, .account-modal-inner {
  overflow: auto;
  padding: 14px;
  flex: 1 1 auto; /* take remaining height */
}

.account-header .title { font-size:1.18rem; font-weight:700; color:var(--text); }
.account-header .controls { display:flex; gap:10px; align-items:center; }

/* Header settings button styling */
#accountModal #openAccountSettings, #accountModal .btn-ghost, .account-header .btn-ghost {
  background: transparent;
  border: 1px solid rgba(148,163,184,0.06);
  padding:8px 12px;
  border-radius:10px;
  color:var(--text);
}
#accountModal #openAccountSettings:hover { background: rgba(255,255,255,0.02); }

/* Modal body grid and panels */
.account-body {
  display:grid;
  grid-template-columns: clamp(220px, 26%, 340px) 1fr;
  gap: clamp(10px, 2.2vw, 22px);
  padding: clamp(12px, 1.6vw, 20px);
}
.account-left { padding: 14px; }
.account-right { padding: 14px; }

/* Avatar and meta */
.account-avatar { width:clamp(44px, 4.2vw, 72px); height:clamp(44px, 4.2vw, 72px); border-radius:12px; font-size:22px; }

/* Override reference avatar sizes from styles.css to scale down on narrow viewports */
@media (max-width: 760px) {
  .account-avatar { width: clamp(40px, 8vw, 56px) !important; height: clamp(40px, 8vw, 56px) !important; }
}
.account-meta .email { font-weight:700; font-size:0.95rem; }
.account-meta .sub { font-size:0.88rem; color:var(--text-soft); }

/* Stat cards: subtle elevation and spacing */
.stat-card { padding: clamp(8px,1.2vw,14px) clamp(10px,1.4vw,14px); border-radius:10px; background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00)); border:1px solid rgba(255,255,255,0.02); }
.stat-card .num { font-size:1.15rem; }

/* Actions panel */
.account-right .panel { padding: 12px; }
.account-right .action-list { display:flex; gap:10px; flex-wrap:wrap; }
.account-right .action-list .btn { padding:8px 12px; }

/* Preferences panel */
.account-preferences { padding:12px; }

/* Scrollbar inside modal (subtle) */
.account-dialog::-webkit-scrollbar, .modal-content::-webkit-scrollbar { width: 10px; }
.account-dialog::-webkit-scrollbar-track, .modal-content::-webkit-scrollbar-track { background: rgba(6,8,12,0.6); border-radius:999px; }
.account-dialog::-webkit-scrollbar-thumb, .modal-content::-webkit-scrollbar-thumb { background: rgba(148,163,184,0.18); border-radius:999px; }

/* Mobile: full width sheet for comfortable reading */

/* Strong viewport-centering safety net for all modal/dialog UI
   Some modals were rendered outside the visible viewport due to
   conflicting rules (absolute positioning, transformed ancestors or
   id-specific offsets). The rules below are deliberately specific
   and use !important where necessary to override legacy styles and
   ensure every modal stays centered and fits the viewport.

   Notes:
   - This block prefers the .modal fixed/flex centering model and
     also applies to native <dialog> and common id selectors like
     #accountModal. It constrains modal content to viewport height
     so internal scrolling works reliably.
*/
.modal, dialog[open], [role="dialog"], #accountModal {
  /* fixed to viewport and use flex centering */
  position: fixed !important;
  inset: 0 !important; /* top:0; right:0; bottom:0; left:0 */
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  z-index: 99999 !important;
  pointer-events: auto !important;
  padding: 12px !important; /* breathing room on narrow viewports */
  box-sizing: border-box !important;
}

/* Ensure overlay always covers viewport and sits behind modal content */
.modal-overlay, .account-overlay {
  position: fixed !important;
  inset: 0 !important;
  width: 100vw !important;
  height: 100vh !important;
  z-index: 99990 !important;
  pointer-events: auto !important;
}

/* When account modal is open explicitly, hide any modal overlays to show only the account dialog */
body.account-modal-open .modal-overlay,
body.account-modal-open .account-overlay,
body.account-modal-open #accountModalOverlay,
body.account-modal-open #publicProfileOverlay,
body.account-modal-open .preview-modal .modal-overlay {
  display: none !important;
  visibility: hidden !important;
  pointer-events: none !important;
  background: transparent !important;
}

/* Force account dialog rounded corners and consistent padding when shown */
#accountModal .modal-content, #accountModal > .account-dialog, .account-modal-content, .account-dialog {
  border-radius: var(--rm-radius-xl) !important;
  overflow: hidden !important;
}

/* Remove any page-specific overlay behind editor input areas (review.html) */
.editor-page .workspace::before,
.editor-page .workspace::after,
.editor-page .panel::before {
  display: none !important;
}

/* Constrain modal content to viewport and allow internal scrolling */
.modal-content, #accountModal .modal-content, dialog .modal-content, [role="dialog"] .modal-content {
  position: relative !important;
  z-index: 99995 !important;
  width: min(var(--rm-modal-maxwidth, 920px), calc(100% - 48px)) !important;
  max-width: var(--rm-modal-maxwidth, 920px) !important;
  max-height: calc(100vh - 48px) !important;
  margin: 0 auto !important;
  overflow: auto !important;
  transform: none !important;
  top: auto !important;
  left: auto !important;
}

/* Disable sheet mode forcing bottom pinning - keep modals centered */
.modal.sheet {
  --rm-sheet-disabled: 1;
  align-items: center !important;
  justify-content: center !important;
}

/* Extra: ensure native dialog elements also center */
dialog[open] { display: flex !important; align-items: center !important; justify-content: center !important; }

@media (max-width:880px) {
  #accountModal .modal-content, .account-modal-content { width: calc(100% - 24px); border-radius: 12px; }
  .account-body { grid-template-columns: 1fr; }
}

/* Extra high-specificity safety net for the account modal to avoid legacy rules
   in other files from pushing it off-screen. Placed at the end so it wins. */
#accountModal, #accountModal.show {
  position: fixed !important;
  inset: 0 !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  pointer-events: auto !important;
  z-index: 10080 !important;
}
#accountModal > .modal-content, #accountModal .modal-content {
  position: relative !important;
  margin: 0 auto !important;
  left: auto !important;
  top: auto !important;
  transform: none !important;
  max-height: 86vh !important;
  overflow: hidden !important;
}

/* When a modal is open, force only the shown modal to be interactive */
/* Ensure modals are not visible by default (defensive) */
.modal { display: none !important; }
.modal.show { display: flex !important; pointer-events: auto !important; }

/* Overlay should capture pointer events when visible and be visually subtle */
.modal-overlay { pointer-events: auto; opacity: 1; transition: opacity 180ms var(--rm-ease); }
.modal-overlay:not(.show) { opacity: 0; pointer-events: none; }

/* Improve sheet drag affordance on mobile: add a small grabber */
.modal.sheet .modal-header::before,
.modal .modal-header::before {
  content: '';
  display: block;
  width: 48px;
  height: 6px;
  border-radius: 99px;
  background: rgba(255,255,255,0.06);
  margin: 8px auto 10px auto;
}

/* Slightly increase contrast for modal content on small screens */
@media (max-width:880px) {
  .modal .modal-content { box-shadow: 0 30px 90px rgba(2,6,23,0.6); }
}
/* Do not use a global body.modal-open pointer-events rule: it can block
  overlays or nested modals. Each modal controls its own pointer-events via
  the .modal and .modal.show rules above. */
.modal:not(.show) { pointer-events: none; }
.modal-header { display:flex; align-items:center; justify-content:space-between; gap:12px; padding-bottom:8px; border-bottom:1px solid rgba(148,163,184,0.03); }
.modal-header h2, .modal-header h3 { margin:0; font-size:1.15rem; }
.modal-close { background:transparent; border:0; color:var(--text-muted); padding:6px; border-radius:8px; }
.modal-close:hover { color:var(--text); background: rgba(255,255,255,0.02); }

/* Public profile specific tweaks */
#publicProfileModal .account-profile, #accountModal .account-profile { display:flex; gap:12px; align-items:center; }
#publicProfileModal .account-avatar, #accountModal .account-avatar { width:48px; height:48px; border-radius:12px; display:grid; place-items:center; background:rgba(255,255,255,0.03); }

/* Ensure owner settings button is visually elevated */
#publicProfileModal .btn-ghost, #publicProfileModal .btn { border-radius:10px; }
#publicProfileModal #publicProfileSettingsBtn { display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:12px; }

/* Library cards compacter and uniform */
.compact-library-list .compact-library-item { padding:14px; border-radius:14px; border:1px solid rgba(148,163,184,0.04); background: linear-gradient(180deg, rgba(8,14,22,0.36), rgba(6,10,16,0.28)); }
.compact-library-list .compact-library-item .title { font-weight:700; margin-bottom:6px; }

/* Editor form inputs and panels */
.review-form .form-content { background: transparent; }
.input, input[type="text"], textarea { background: rgba(10,18,34,0.5); border: 1px solid var(--rm-panel-border); padding:10px 12px; border-radius:10px; color:var(--text); }
.input:focus, textarea:focus { box-shadow: 0 8px 30px rgba(52,211,153,0.08); outline:none; }

/* Quick visual for segmented privacy control */
.segmented button { padding:8px 12px; border-radius:10px; }
.segmented button[aria-pressed="true"] { background: linear-gradient(90deg,var(--primary,#34d399),var(--accent,#38bdf8)); color:#04202a; }

/* Floating auth button alignment */
.floating-auth-btn { right:clamp(12px,2.2vw,36px); bottom:clamp(12px,2.2vw,36px); box-shadow:0 14px 40px rgba(2,6,23,0.6); }

/* Accessibility: visible focus ring for keyboard users */
button:focus, .input:focus, .modal-close:focus { outline: 3px solid rgba(52,211,153,0.14); }

/* Mobile tweaks */
@media (max-width:700px) {
  .modal-content { width: calc(100% - 28px); border-radius: 12px; }
  .top-nav { padding: 12px; }
}
/* components.css - component-specific rules */
.profile-stats .stats-grid{display:flex;gap:12px}
.stat-card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:12px;border-radius:10px}
.account-stats-by-type{display:flex;gap:8px;flex-wrap:wrap}

/* Responsive small thumbnail used in lists */
.rm-thumb { width: clamp(36px, 6.2vw, 56px); height: clamp(36px, 6.2vw, 56px); border-radius: 8px; overflow: hidden; border: 1px solid var(--glass-border); display:inline-grid; vertical-align:middle; }
.rm-thumb img { width:100%; height:100%; object-fit:cover; display:block; }

/* Ensure titles with thumbs align nicely */
.meta .title { display:flex; align-items:center; gap: clamp(8px, 1.2vw, 12px); }

/* Override legacy rules in styles.css that forcibly hide #publicProfileModal
   Ensure the public profile modal follows the .modal/.modal.show flex behavior */
#publicProfileModal { display: none !important; visibility: hidden !important; }
#publicProfileModal.show {
  display: flex !important;
  visibility: visible !important;
  align-items: center;
  justify-content: center;
}

/* Public profile is preview-only: hide its dark backdrop so only the modal content shows */
#publicProfileModal .modal-overlay,
#publicProfileOverlay {
  display: none !important;
  background: transparent !important;
  pointer-events: none !important;
}

/* Strong overrides to make components.css authoritative for modal visuals
   These rules deliberately use higher specificity to neutralize legacy files
   (styles.css and src/style/base.css) that define other modal defaults. */
body .modal { position: fixed !important; inset: 0 !important; display: none !important; align-items: center !important; justify-content: center !important; }
body .modal.show { display: flex !important; pointer-events: auto !important; }
/* Ensure overlay fully covers viewport and sits above legacy UI */
/* Make overlay sit *below* modal-content but above page UI.
  Use a high but reasonable z-index to avoid stomping on other global
  elements (some legacy rules used astronomically high values).
  Also prefer fixed positioning so orphan overlays cannot appear in
  odd locations due to parent stacking contexts. */
body .modal-overlay { position: fixed !important; inset: 0 !important; width: 100% !important; height: 100% !important; background: var(--rm-modal-overlay) !important; backdrop-filter: blur(8px) !important; z-index: 10060 !important; }
/* Keep modal content above the overlay */
/* Keep modal content above the overlay but below transient UI like toasts
  that may want to appear above modals. Use conservative z-index values. */
body .modal-content { position: relative !important; z-index: 10070 !important; }

/* Ensure preview-only modals or those explicitly hidden via helper will not show an overlay */
.modal.preview-only .modal-overlay, .modal[data-backdrop="none"] > .modal-overlay, #accountModal[data-backdrop="none"] > .account-overlay { display: none !important; pointer-events: none !important; background: transparent !important; }

/* Ensure overlays are only visible when their modal is explicitly shown.
  This prevents orphaned overlay elements (left in the DOM or created
  programmatically) from appearing as small grey blocks in the viewport.
*/
body .modal:not(.show) > .modal-overlay { display: none !important; visibility: hidden !important; pointer-events: none !important; }
body .modal.show > .modal-overlay { display: block !important; visibility: visible !important; pointer-events: auto !important; }
.modal-overlay:not(.show) { display: none !important; }

/* Defensive: if preview elements end up without the `hidden` attribute,
  force them hidden unless explicitly opened via script. This avoids the
  small grey preview panel showing in the top-left when not in use. */
#previewOverlay[hidden], #previewModal[hidden] { display: none !important; visibility: hidden !important; opacity: 0 !important; pointer-events: none !important; }

/* Position account modal: don't rely on absolute centering which can break
   when ancestors are transformed or when left is not set. Use relative
   positioning and auto margins so the dialog is always horizontally centered.
   If a slight vertical offset is desired, JS can set --rm-account-offset and
   the script should add a helper class that adjusts translateY only. */
#accountModal .modal-content.centered {
  position: relative !important;
  top: auto !important;
  left: auto !important;
  transform: none !important;
  margin: 0 auto !important;
  max-width: 820px;
  width: min(820px, calc(100% - 56px));
}

/* In case an overlay was accidentally inserted outside a modal, ensure
  any standalone .modal-overlay can't appear above the UI unless it has
  an explicit .show class and belongs to a shown modal. */
.modal-overlay { box-sizing: border-box; }

/* Defensive: hide any tiny orphan preview panels that sometimes remain
   visible in the top-left due to legacy scripts inserting DOM fragments.
   This targets very small overlays/modal fragments so we don't hide
   legitimate full-screen modals. */
.modal-overlay[style*="width: 1px"], .modal-overlay[style*="height: 1px"], .modal-overlay[style*="left: 0px; top: 0px; width: 100px; height: 100px"] {
  display: none !important; visibility: hidden !important; pointer-events: none !important;
}

/* Ensure key modals are perfectly centered on desktop (override legacy offsets)
   Targets the specific modal IDs used across the app: auth, account, public profile,
   save modal, settings and library modal. Use high-specificity and !important to
   neutralize older conflicting rules in styles.css. */
@media (min-width: 881px) {
  /* Only show key modals when they have been opened (.show) or when
     the centered-modal container class is applied. This prevents CSS from
     forcing modals visible at page load. */
  #authModal.show, #accountModal.show, #publicProfileModal.show, #saveModal.show, #settingsModal.show, #libraryModal.show,
  .centered-modal {
    position: fixed !important;
    left: 50% !important;
    top: 50% !important;
    transform: translate(-50%, -50%) !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    width: auto !important;
    max-width: var(--rm-modal-maxwidth) !important;
    z-index: 10070 !important; /* above overlay */
    pointer-events: auto !important;
  }

  /* Ensure their modal-content is positioned relative inside the centered modal container
     and cancel any earlier top/calc-based nudges. This avoids the dialog being shifted up. */
  #authModal.show .modal-content, #accountModal.show .modal-content, #publicProfileModal.show .modal-content, #saveModal.show .modal-content, #settingsModal.show .modal-content, #libraryModal.show .modal-content,
  .centered-modal .modal-content {
    position: relative !important;
    top: auto !important;
    left: auto !important;
    transform: none !important;
    margin: 0 auto !important;
    z-index: 10080 !important; /* ensure content above overlay as well */
  }

  /* Cancel the subtle upward shift that was applied to account modal in some rules */
  #accountModal.show .modal-content.centered, .centered-modal .modal-content.centered {
    top: 50% !important;
    transform: translate(-50%, -50%) !important;
  }
}

/* Centered-modal container: use flex centering and allow content to decide sheet vs centered
   This avoids putting modal dialog itself at absolute top/left which sometimes causes
   the dialog to be misaligned when parent contexts are transformed. */
@media (min-width: 881px) {
  .centered-modal {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    position: fixed !important;
    inset: 0 !important;
    z-index: 10070 !important;
    pointer-events: auto !important;
  }
  .centered-modal .modal-content {
    position: relative !important;
    transform: translateY(0) !important;
    margin: 0 auto !important;
    max-height: 86vh !important;
    overflow: hidden !important;
  }
  /* If content height > available, script will add .sheet to the modal which
     should keep it pinned to bottom — keep that behavior intact */
  .centered-modal.sheet { align-items: flex-end !important; }
}

