// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// Modèle User (utilisateurs Discord)
model User {
  id            String   @id @default(uuid())
  discordId     String   @unique
  username      String
  discriminator String?
  avatar        String?
  email         String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  reviews  Review[]
  sessions Session[]
  likes    ReviewLike[]

  @@map("users")
}

// Modèle Session (authentification)
model Session {
  id        String   @id @default(uuid())
  sid       String   @unique
  userId    String
  expiresAt DateTime
  createdAt DateTime @default(now())

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

// Modèle Review (reviews cannabis)
model Review {
  id          String   @id @default(uuid())
  holderName  String // Nom de la variété
  type        String // Indica, Sativa, Hybride, CBD
  description String?
  
  // Notation
  note        Float?
  ratings     String? // JSON: {apparence: 8, odeur: 9, gout: 7, effets: 8.5}
  
  // Profil terpénique et tags
  terpenes    String? // JSON: ["Myrcène", "Limonène", "Pinène"]
  tastes      String? // JSON: ["Citron", "Terreux", "Pin"]
  aromas      String? // JSON: ["Citron", "Boisé", "Fruité"]
  effects     String? // JSON: ["Relaxant", "Euphorique", "Créatif"]
  
  // Type de variété
  strainType  String? // "Indica Pur", "Hybride Indica", "Équilibré", "Hybride Sativa", "Sativa Pur"
  indicaRatio Int?    // 0-100 (0 = Sativa pur, 100 = Indica pur)
  
  // Champs spécifiques Hash/Concentré/Comestible
  cultivarsList        String? // JSON: Array de cultivars utilisés
  pipelineExtraction   String? // JSON: Pipeline d'extraction
  pipelineSeparation   String? // JSON: Pipeline de séparation
  purgevide            Boolean? // Purge à vide pour extraits solvants
  hashmaker            String? // Nom du hash maker
  breeder              String? // Breeder de la graine
  farm                 String? // Farm productrice
  cultivars            String? // Nom du/des cultivar(s)
  extraData            String? // JSON: Autres données dynamiques
  
  // Images
  images      String? // JSON: ["image1.jpg", "image2.jpg", ...]
  mainImage   String? // Image principale
  
  // Métadonnées
  isPublic    Boolean  @default(true)
  isPrivate   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Auteur
  authorId    String
  author      User     @relation(fields: [authorId], references: [id], onDelete: Cascade)
  
  // Likes
  likes       ReviewLike[]

  @@index([authorId])
  @@index([type])
  @@index([createdAt])
  @@map("reviews")
}

// Modèle ReviewLike (likes/dislikes des reviews)
model ReviewLike {
  id        String   @id @default(uuid())
  reviewId  String
  userId    String
  isLike    Boolean  // true = like, false = dislike
  createdAt DateTime @default(now())

  // Relations
  review Review @relation(fields: [reviewId], references: [id], onDelete: Cascade)
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([reviewId, userId]) // Un utilisateur ne peut liker/disliker qu'une fois
  @@index([reviewId])
  @@index([userId])
  @@map("review_likes")
}
