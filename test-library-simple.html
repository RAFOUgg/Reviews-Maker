<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <title>Test Simple Library</title>
    <style>
        body {
            background: #1a1a2e;
            color: #eee;
            padding: 20px;
            font-family: system-ui;
        }

        button {
            background: #4ecca3;
            color: #000;
            border: none;
            padding: 15px 30px;
            margin: 10px;
            cursor: pointer;
            font-size: 16px;
            border-radius: 4px;
        }

        .modal {
            position: fixed;
            inset: 0;
            display: none;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
        }

        .modal-content {
            background: #16213e;
            padding: 40px;
            border-radius: 8px;
            max-width: 800px;
            max-height: 80vh;
            overflow: auto;
        }

        .modal h2 {
            margin-top: 0;
            color: #4ecca3;
        }

        .log {
            background: #0f3460;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>

<body>
    <h1>üß™ Test Library Modal - Version Simplifi√©e</h1>

    <button onclick="testBasic()">1. Test Basique (display: flex)</button>
    <button onclick="testWithFunction()">2. Test Avec Fonction</button>
    <button onclick="testFullFlow()">3. Test Flow Complet</button>
    <button onclick="closeModal()">‚ùå Fermer Modal</button>

    <div id="logs"></div>

    <!-- Modal simplifi√© -->
    <div id="libraryModal" class="modal">
        <div class="modal-content">
            <h2>üìÅ Ma Biblioth√®que</h2>
            <p>Ce modal devrait s'afficher quand on clique sur les boutons.</p>
            <div id="libraryGrid">
                <p>Contenu de la biblioth√®que ici...</p>
            </div>
            <button onclick="closeModal()" style="background: #e94560; margin-top: 20px;">Fermer</button>
        </div>
    </div>

    <script>
        function log(msg, type = 'info') {
            const div = document.createElement('div');
            div.className = 'log';
            div.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            div.style.borderLeft = type === 'error' ? '4px solid #e94560' :
                type === 'success' ? '4px solid #4ecca3' :
                    '4px solid #4a90e2';
            document.getElementById('logs').prepend(div);
            console.log(msg);
        }

        function testBasic() {
            log('Test 1: Ouverture basique avec display: flex');
            const modal = document.getElementById('libraryModal');
            if (!modal) {
                log('‚ùå Modal introuvable!', 'error');
                return;
            }
            log(`Modal trouv√©, display actuel: ${modal.style.display}`);
            modal.style.display = 'flex';
            log(`Display chang√© √†: ${modal.style.display}`, 'success');

            // V√©rifier computed style
            const computed = window.getComputedStyle(modal);
            log(`Computed display: ${computed.display}`);
            log(`Computed z-index: ${computed.zIndex}`);
            log(`Computed visibility: ${computed.visibility}`);
        }

        function testWithFunction() {
            log('Test 2: Ouverture via fonction simul√©e');

            function openLibraryModal() {
                log('  ‚Üí Fonction openLibraryModal appel√©e');
                const modal = document.getElementById('libraryModal');

                if (!modal) {
                    log('  ‚ùå Modal non trouv√©!', 'error');
                    return;
                }

                log('  ‚úÖ Modal trouv√©, ouverture...');
                modal.style.display = 'flex';
                log('  ‚úÖ Modal affich√©!', 'success');
            }

            openLibraryModal();
        }

        function testFullFlow() {
            log('Test 3: Simulation du flow complet de Reviews-Maker');

            // Simuler l'objet dom
            const dom = {
                libraryModal: document.getElementById('libraryModal'),
                libraryGrid: document.getElementById('libraryGrid'),
                libraryDrawer: null // Comme dans index.html
            };

            log(`  dom.libraryModal: ${!!dom.libraryModal}`);
            log(`  dom.libraryGrid: ${!!dom.libraryGrid}`);
            log(`  dom.libraryDrawer: ${!!dom.libraryDrawer}`);

            // Simuler openLibraryModal
            function openLibraryModal(mode, options) {
                log(`  ‚Üí openLibraryModal('${mode}', ${JSON.stringify(options)})`);

                if (dom.libraryDrawer) {
                    log('  ‚Üí Drawer mode d√©tect√© (ne devrait pas arriver)');
                    return;
                }

                if (!dom.libraryModal) {
                    log('  ‚ùå libraryModal introuvable!', 'error');
                    return;
                }

                log('  ‚úÖ Ouverture du modal...');
                dom.libraryModal.style.display = 'flex';

                log('  ‚úÖ Appel renderFullLibrary...');
                renderFullLibrary(mode);
            }

            function renderFullLibrary(mode) {
                log(`  ‚Üí renderFullLibrary('${mode}')`);

                if (!dom.libraryGrid) {
                    log('  ‚ùå libraryGrid introuvable!', 'error');
                    return;
                }

                log('  ‚úÖ Grid trouv√©, rendu du contenu...');
                dom.libraryGrid.innerHTML = `
          <div style="padding: 20px; background: #0f3460; border-radius: 4px; margin: 10px 0;">
            <h3 style="color: #4ecca3; margin-top: 0;">Mode: ${mode}</h3>
            <p>Simulation de reviews...</p>
            <p>‚Ä¢ Review 1</p>
            <p>‚Ä¢ Review 2</p>
            <p>‚Ä¢ Review 3</p>
          </div>
        `;
                log('  ‚úÖ Contenu affich√©!', 'success');
            }

            // Ex√©cuter le flow
            openLibraryModal('mine', { fromAccount: true });
        }

        function closeModal() {
            log('Fermeture du modal');
            const modal = document.getElementById('libraryModal');
            if (modal) {
                modal.style.display = 'none';
                log('‚úÖ Modal ferm√©', 'success');
            }
        }

        // Log initial
        window.addEventListener('DOMContentLoaded', () => {
            log('Page charg√©e, √©l√©ments pr√™ts', 'success');
            log(`Modal #libraryModal: ${!!document.getElementById('libraryModal')}`);
            log(`Grid #libraryGrid: ${!!document.getElementById('libraryGrid')}`);
        });
    </script>
</body>

</html>