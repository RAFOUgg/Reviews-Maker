<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Composition, prévisualisation et exportation de reviews produits cannabis. Communauté et partage d'expertise." />
  <title>📑 Reviews Maker </title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
  <link rel="icon" type="image/png" href="ink\logo.png" />
</head>
<body class="home-page">
  <div class="app-shell">
    <header class="top-nav" role="banner">
      <div class="brand" role="button" tabindex="0" aria-label="Accueil">
        <span class="brand-mark" aria-hidden="true"><img src="ink\logo.png" alt="" style="width:22px;height:22px;object-fit:contain;border-radius:4px" /></span>
        <div class="brand-text">
          <strong>Reviews Maker</strong>
          <span>Analyse de qualité</span>
        </div>
      </div>
      <div class="top-nav-status">
          <div class="nav-actions">
          <span class="pill-btn" id="openTips" title="Afficher les raccourcis et astuces" tabindex="0" role="button">
            <span aria-hidden="true">💡</span>
            Astuce
          </span>
        </div>
      </div>
    </header>

    <main class="workspace home-workspace" role="main">
      <!-- Section Hero -->
      <section class="hero-section">
        <div class="hero-content">
          <h1 class="hero-title">Composez une review premium</h1>
          <p class="hero-subtitle">Sélectionnez le type de produit pour activer les blocs adaptés.</p>
          
          <!-- Sélection du type de produit -->
          <div class="type-selector" role="list">
            <button type="button" class="type-card" data-type="Hash" role="listitem">
              <span class="type-icon" aria-hidden="true">🍫</span>
              <div class="type-content">
                <span class="type-title">Hash</span>
                <span class="type-caption">bubble hash, WPFF, dry sift, etc.</span>
              </div>
            </button>
            <button type="button" class="type-card" data-type="Fleur" role="listitem">
              <span class="type-icon" aria-hidden="true">🍃</span>
              <div class="type-content">
                <span class="type-title">Fleur</span>
                <span class="type-caption">Indoor, outdoor, greenhouse…</span>
              </div>
            </button>
            <button type="button" class="type-card" data-type="Concentré" role="listitem">
              <span class="type-icon" aria-hidden="true">🍯</span>
              <div class="type-content">
                <span class="type-title">Concentré</span>
                <span class="type-caption">Rosin, BHO, live resin, etc.</span>
              </div>
            </button>
            <button type="button" class="type-card" data-type="Comestible" role="listitem">
              <span class="type-icon" aria-hidden="true">🍬</span>
              <div class="type-content">
                <span class="type-title">Comestible</span>
                <span class="type-caption">Pâtisserie, boisson, huile…</span>
              </div>
            </button>
          </div>

          <!-- Actions rapides retirées: la gestion des brouillons se fait via la galerie -->
        </div>
      </section>

      <!-- Bibliothèque des reviews -->
      <section class="library-section">
        <div class="section-header">
          <h2 class="section-title">
            <span aria-hidden="true">📚</span>
            Galerie publique
          </h2>
          <button type="button" class="btn btn-ghost" id="openFullLibrary">Voir tout</button>
        </div>

        <!-- Bibliothèque compacte -->
        <div class="compact-library" id="compactLibrary">
          <div class="compact-library-empty" id="compactLibraryEmpty" style="display: none;">
            <span class="empty-icon" aria-hidden="true">📝</span>
            <p>Aucune review encore créée</p>
            <span class="empty-hint">Commencez par choisir un type de produit ci-dessus</span>
          </div>
          <div class="compact-library-list" id="compactLibraryList"></div>
          <div class="library-actions-below">
            <button type="button" class="btn btn-outline" id="showMoreLibrary">Voir plus</button>
          </div>
        </div>
      </section>
    </main>

    <!-- Modal Bibliothèque complète -->
    <div class="modal" id="libraryModal" style="display: none;">
      <div class="modal-overlay" id="libraryModalOverlay"></div>
      <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="libraryTitle">
        <div class="modal-header">
          <div style="display:flex;align-items:center;gap:12px;">
            <button type="button" class="btn btn-ghost" id="libraryBackToAccount" style="display:none;">← Retour</button>
            <h2 id="libraryTitle">🖼️ Galerie publique</h2>
          </div>
          <button type="button" class="modal-close" id="closeLibrary" aria-label="Fermer">
            <span aria-hidden="true">×</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="search-bar">
            <input type="text" id="librarySearch" placeholder="Rechercher par nom, variété, farm..." class="search-input">
          </div>
          <div class="library-grid" id="libraryGrid">
            <!-- Reviews complètes seront générées ici -->
          </div>
          <div class="library-empty" id="libraryEmpty" style="display: none;">
            <span class="empty-icon" aria-hidden="true">📚</span>
            <p>Aucune review trouvée</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Astuces -->
    <div class="modal" id="tipsModal" style="display: none;">
      <div class="modal-overlay" id="tipsModalOverlay"></div>
      <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="tipsTitle">
        <div class="modal-header">
          <h2 id="tipsTitle">Raccourcis & Astuces</h2>
          <button type="button" class="modal-close" id="closeTips" aria-label="Fermer">
            <span aria-hidden="true">×</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="tips-content">
            <div class="tip-group">
              <h3>🎯 Navigation</h3>
              <ul>
                <li><kbd>Tab</kbd> / <kbd>Shift</kbd> + <kbd>Tab</kbd> : Navigation entre les champs</li>
                <li><kbd>Échap</kbd> : Fermer les modales</li>
                <li>Cliquer sur le logo : Retour à l'accueil</li>
              </ul>
            </div>
            <div class="tip-group">
              <h3>✨ Fonctionnalités</h3>
              <ul>
                <li>Sauvegarde automatique pendant la saisie</li>
                <li>Aperçu en temps réel</li>
                <li>Export haute qualité en PNG</li>
                <li>Gestion des brouillons</li>
              </ul>
            </div>
            <div class="tip-group">
              <h3>📝 Bonnes pratiques</h3>
              <ul>
                <li>Remplissez au minimum les sections obligatoires</li>
                <li>Ajoutez une photo pour un rendu optimal</li>
                <li>Utilisez des descriptions détaillées</li>
                <li>Sauvegardez régulièrement vos reviews importantes</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Connexion / Authentification -->
    <!-- Redesigned Account Modal (same structure as in review.html) -->
    <div id="accountModal" aria-hidden="true">
      <div class="account-overlay" id="accountModalOverlay"></div>
      <div class="account-dialog" role="dialog" aria-modal="true" aria-labelledby="accountTitle">
        <div class="account-header">
          <h3 id="accountTitle">Mon compte</h3>
          <div style="display:flex;gap:8px;align-items:center;">
            <button type="button" class="btn btn-ghost" id="openAccountSettings" title="Paramètres">⚙️ Paramètres</button>
            <button type="button" class="modal-close" id="closeAccountModal" aria-label="Fermer">✕</button>
          </div>
        </div>
        <div class="account-body">
          <div class="account-left">
            <div class="account-profile">
              <div class="account-avatar">👤</div>
              <div class="account-meta">
                <div id="accountEmail">—</div>
                <div class="sub">Membre Reviews Maker</div>
              </div>
            </div>
            <div class="stats-grid" aria-hidden="false">
              <div class="stat-card"><div class="num" id="accountTotal">0</div><div class="label">Total</div></div>
              <div class="stat-card"><div class="num" id="statPublic">0</div><div class="label">Public</div></div>
              <div class="stat-card"><div class="num" id="statPrivate">0</div><div class="label">Privé</div></div>
            </div>
            <div style="margin-top:10px;"><h4 class="section-title">Répartition par type</h4>
              <div id="accountStatsByType" class="account-stats-by-type"></div>
            </div>
          </div>
          <div class="account-right">
            <div class="panel">
              <div style="display:flex;align-items:center;justify-content:space-between;">
                <h4 class="section-title">Actions</h4>
              </div>
              <div style="margin-top:10px;display:flex;flex-direction:column;gap:8px;"><button class="btn btn-outline" id="openLibraryFromAccount">Ma bibliothèque</button><button class="btn btn-outline" id="accountDisconnect">Se déconnecter</button></div>
            </div>
            <div class="panel" id="accountPreferences">
              <h4 class="section-title">Préférences</h4>
              <div style="color:var(--text-soft);">Consulter et modifier vos paramètres via Paramètres.</div>
              <div style="margin-top:10px;"><button class="btn btn-ghost" id="openAccountSettingsInline">Ouvrir Paramètres</button></div>
            </div>
            <div id="accountSettingsPanel" class="account-settings-panel" style="display:none;">
              <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px;"><button class="btn btn-ghost" id="accountSettingsBack">← Retour</button><h4 class="section-title">Paramètres</h4></div>
              <div class="panel">
                <h5>Confidentialité</h5>
                <div style="color:var(--text-soft);margin-top:6px;">Options de partage et visibilité par défaut.</div>
                <div style="margin-top:8px;display:flex;gap:8px;align-items:center;"><label class="boolean-group" style="gap:8px;"><input type="checkbox" id="defaultPublic" /><span>Publier mes nouvelles reviews par défaut</span></label></div>
              </div>
              <div class="panel" style="margin-top:10px;">
                <h5>Préférences</h5>
                <div style="color:var(--text-soft);margin-top:6px;">Choisissez un thème :</div>
                <div style="margin-top:10px;"><div id="themeOptions" class="theme-options" role="radiogroup" aria-label="Choix du thème"><button type="button" class="theme-option" data-theme="violet" title="Violet sombre" aria-checked="false" role="radio"><span class="theme-swatch swatch-violet" aria-hidden="true"></span></button><button type="button" class="theme-option" data-theme="rose" title="Rose pâle" aria-checked="false" role="radio"><span class="theme-swatch swatch-rose" aria-hidden="true"></span></button><button type="button" class="theme-option" data-theme="bluish" title="Bleu foncé" aria-checked="false" role="radio"><span class="theme-swatch swatch-bluish" aria-hidden="true"></span></button></div></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  <div class="modal" id="authModal" style="display: none;">
    <div class="modal-overlay" id="authModalOverlay"></div>
    <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="authTitle">
      <div class="modal-header">
        <h2 id="authTitle">Connexion</h2>
        <button type="button" class="modal-close" id="closeAuth" aria-label="Fermer">
          <span aria-hidden="true">×</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="auth-content">
          <p class="auth-description">Liez votre compte pour synchroniser vos reviews sur le serveur et y accéder depuis n'importe quel appareil.</p>
          
          <!-- Étape 1: Demande d'email -->
          <div id="authStepEmail" class="auth-step">
            <div class="form-group">
              <label for="authEmailInput">Adresse email</label>
              <input type="email" id="authEmailInput" class="input" placeholder="votre@email.com" />
            </div>
            <div class="auth-actions">
              <button type="button" class="btn btn-primary" id="authSendCode">Envoyer le code</button>
            </div>
          </div>
          
          <!-- Étape 2: Vérification du code -->
          <div id="authStepCode" class="auth-step" style="display:none;">
            <p class="auth-info">Un code de vérification a été envoyé à <strong id="authEmailDisplay"></strong></p>
            <div class="form-group">
              <label for="authCodeInput">Code de vérification</label>
              <input type="text" id="authCodeInput" class="input" placeholder="123456" maxlength="6" />
            </div>
            <div class="auth-actions">
              <button type="button" class="btn btn-outline" id="authBack">Retour</button>
              <button type="button" class="btn btn-primary" id="authVerifyCode">Vérifier</button>
            </div>
            <p class="auth-help">Code non reçu ? <button type="button" class="link-btn" id="authResendCode">Renvoyer</button></p>
          </div>
          
          <!-- Étape 3: Connecté -->
          <div id="authStepConnected" class="auth-step" style="display:none;">
            <p class="auth-info">Connecté en tant que <strong id="authConnectedEmail"></strong></p>
            <div class="auth-account-summary" style="margin-top:10px;">
              <div style="display:flex; gap:12px; align-items:center;">
                <div><strong id="authConnTotal">0</strong><div style="font-size:0.85rem;color:var(--text-muted);">Total</div></div>
                <div><strong id="authConnPublic">0</strong><div style="font-size:0.85rem;color:var(--text-muted);">Public</div></div>
                <div><strong id="authConnPrivate">0</strong><div style="font-size:0.85rem;color:var(--text-muted);">Privé</div></div>
              </div>
              <div id="authConnByType" style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap;"></div>
            </div>
            <div class="auth-actions" style="margin-top:12px;">
              <button type="button" class="btn btn-outline" id="authOpenLibrary">Ma bibliothèque</button>
              <button type="button" class="btn btn-outline" id="authDisconnect">Se déconnecter</button>
            </div>
          </div>
          
          <div class="auth-status" id="authStatus" style="display:none;"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Public profile modal (read-only, visible to anyone) -->
  <div id="publicProfileModal" aria-hidden="true">
    <div class="account-overlay" id="publicProfileOverlay"></div>
    <div class="account-dialog" role="dialog" aria-modal="true" aria-labelledby="publicProfileTitle">
      <div class="account-header">
        <h3 id="publicProfileTitle">Profil public</h3>
        <div style="display:flex;gap:8px;align-items:center;">
          <button type="button" class="btn btn-ghost" id="publicProfileSettingsBtn" title="Paramètres" style="display:none;">⚙️ Paramètres</button>
          <button type="button" class="modal-close" id="closePublicProfile" aria-label="Fermer">✕</button>
        </div>
      </div>
      <div class="account-body">
        <div class="account-left">
          <div class="account-profile"><div class="account-avatar">👤</div><div class="account-meta"><div id="publicProfileEmail">—</div><div class="sub" id="publicProfileSub">Membre Reviews Maker</div></div></div>
          <div class="stats-grid"><div class="stat-card"><div class="num" id="publicTotal">0</div><div class="label">Total</div></div><div class="stat-card"><div class="num" id="publicPublic">0</div><div class="label">Public</div></div><div class="stat-card"><div class="num" id="publicPrivate">0</div><div class="label">Privé</div></div></div>
          <div style="margin-top:10px;"><h4 class="section-title">Répartition par type</h4><div id="publicByType" class="account-stats-by-type"></div></div>
        </div>
        <div class="account-right">
          <!-- Section 'bibliothèque publique' supprimée -->
        </div>
      </div>
    </div>
  </div>

  <!-- Bouton flottant de connexion -->
  <button type="button" class="floating-auth-btn" id="floatingAuthBtn" title="Lier mon compte">
    <span aria-hidden="true">🔗</span>
  </button>

  <!-- Preview-only Overlay for home page (to visualize a review from gallery) -->
  <div id="previewOverlay" class="preview-overlay" hidden></div>
  <div id="previewModal" class="preview-modal" role="dialog" aria-modal="true" aria-label="Aperçu de la review" hidden>
    <header class="preview-modal-header">
      <h3>Aperçu</h3>
      <div class="actions">
        <button type="button" class="btn btn-secondary btn-sm" id="downloadPreviewPng">Télécharger l'image</button>
        <button type="button" class="pill-btn" id="closePreviewModal" title="Fermer">✕</button>
      </div>
    </header>
    <div class="preview-modal-body">
      <div id="previewModalContent" class="review-content"></div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="app.js?v=2025-10-16-accmodal-1"></script>
</body>
</html>