# Refonte Syst√®me de Comptes & Restrictions ‚Äî 12 d√©cembre 2025

## Vue d'ensemble

Simplification du syst√®me de comptes de 6 vers 3 types principaux selon cahier des charges enrichi :

| Type Actuel | Nouveau Type | Prix | Migration |
|------------|--------------|------|-----------|
| Consumer | **Amateur** | Gratuit | Automatique |
| Beta Tester | Beta Tester | Gratuit | Conserv√© (temporaire) |
| Influencer Basic | **Influencer** | 15.99‚Ç¨/mois | Conserv√© |
| Influencer Pro | **Influencer** | 15.99‚Ç¨/mois | Downgrade tarifaire |
| Producer | **Producer** | 29.99‚Ç¨/mois | Conserv√© |
| Merchant | Producer | 29.99‚Ç¨/mois | Automatique |

---

## Matrice des Fonctionnalit√©s

### 1. Sections Accessibles (Cr√©ation Review)

| Section | Amateur | Influencer | Producer |
|---------|---------|------------|----------|
| Information g√©n√©rale | ‚úÖ | ‚úÖ | ‚úÖ |
| Visuel & Technique | ‚úÖ | ‚úÖ | ‚úÖ |
| Pipeline Curing/Maturation | ‚úÖ | ‚úÖ | ‚úÖ |
| Odeurs | ‚úÖ | ‚úÖ | ‚úÖ |
| Go√ªts | ‚úÖ | ‚úÖ | ‚úÖ |
| Effets ressentis | ‚úÖ | ‚úÖ | ‚úÖ |
| Pipeline Culture (phases configurables) | ‚ùå | ‚ùå | ‚úÖ |
| Pipeline Extraction | ‚ùå | ‚ùå | ‚úÖ |
| G√©n√©tique (Canva arbre) | ‚ùå | ‚ùå | ‚úÖ |

### 2. Templates Export

| Template | Amateur | Influencer | Producer |
|----------|---------|------------|----------|
| Compact (pr√©d√©fini) | ‚úÖ | ‚úÖ | ‚úÖ |
| D√©taill√© (pr√©d√©fini) | ‚úÖ | ‚úÖ | ‚úÖ |
| Complet (pr√©d√©fini) | ‚úÖ | ‚úÖ | ‚úÖ |
| Personnalis√© (drag & drop) | ‚ùå | ‚ùå | ‚úÖ |

**Restrictions Amateur :**
- Format impos√© par template (pas de personnalisation dimensions)
- Templates syst√®me uniquement
- Pas d'acc√®s mode drag & drop

**Ouvertures Influencer :**
- Acc√®s drag & drop pour arrangement zones
- Personnalisation avanc√©e layout
- Templates sauvegardables

**Acc√®s complet Producer :**
- Mode contenus personnalisable
- Drag & drop total
- Cr√©ation templates from scratch

### 3. Formats & Qualit√© Export

| Format | Amateur | Influencer | Producer |
|--------|---------|------------|----------|
| PNG (150dpi) | ‚úÖ | ‚ùå | ‚ùå |
| JPEG (150dpi) | ‚úÖ | ‚ùå | ‚ùå |
| PDF (150dpi) | ‚úÖ | ‚ùå | ‚ùå |
| PNG (300dpi) | ‚ùå | ‚úÖ | ‚úÖ |
| JPEG (300dpi) | ‚ùå | ‚úÖ | ‚úÖ |
| PDF (300dpi) | ‚ùå | ‚úÖ | ‚úÖ |
| SVG | ‚ùå | ‚úÖ | ‚úÖ |
| CSV | ‚ùå | ‚ùå | ‚úÖ |
| JSON | ‚ùå | ‚ùå | ‚úÖ |
| HTML | ‚ùå | ‚ùå | ‚úÖ |
| GIF (Pipeline timeline) | ‚ùå | ‚ùå | ‚úÖ |

**Limites :**
- Amateur : max 3 exports/jour
- Influencer : 50 exports/jour
- Producer : illimit√©

### 4. Personnalisation Export

| Fonctionnalit√© | Amateur | Influencer | Producer |
|----------------|---------|------------|----------|
| Th√®me clair/sombre | ‚úÖ | ‚úÖ | ‚úÖ |
| Choix couleurs (palette) | ‚úÖ | ‚úÖ | ‚úÖ |
| Configuration typo (tailles) | ‚úÖ | ‚úÖ | ‚úÖ |
| Configuration image (ratio, filters) | ‚úÖ | ‚úÖ | ‚úÖ |
| Polices personnalis√©es (upload TTF/OTF) | ‚ùå | ‚ùå | ‚úÖ |
| Filigrane personnalis√© | ‚ùå | ‚úÖ | ‚úÖ |
| Filigrane syst√®me (obligatoire) | ‚úÖ (forc√©) | ‚ùå | ‚ùå |
| Agencement complet modules | ‚ùå | ‚úÖ | ‚úÖ |
| Branding (logo entreprise) | ‚ùå | ‚ùå | ‚úÖ |

### 5. Biblioth√®que Personnelle

| √âl√©ment | Amateur | Influencer | Producer |
|---------|---------|------------|----------|
| Sauvegarde templates | 3 max | 20 max | Illimit√© |
| Filigranes | 1 max | 5 max | Illimit√© |
| Reviews priv√©es | 10 max | 100 max | Illimit√© |
| Cultivars (biblioth√®que) | ‚ùå | ‚ùå | Illimit√© |
| Projets PhenoHunt | ‚ùå | ‚ùå | Illimit√© |
| Saved Data (substrats, engrais) | 10 max | 50 max | Illimit√© |

### 6. Galerie Publique

| Fonctionnalit√© | Amateur | Influencer | Producer |
|----------------|---------|------------|----------|
| Publication reviews publiques | ‚úÖ | ‚úÖ | ‚úÖ |
| Likes | ‚úÖ | ‚úÖ | ‚úÖ |
| Commentaires | ‚úÖ | ‚úÖ | ‚úÖ |
| Badge "V√©rifi√©" | ‚ùå | ‚úÖ | ‚úÖ |
| Badge "Producteur Certifi√©" | ‚ùå | ‚ùå | ‚úÖ |
| Analytics vues | ‚ùå | ‚úÖ | ‚úÖ |
| Partage r√©seaux sociaux (API) | ‚ùå | ‚úÖ | ‚úÖ |

### 7. Statistiques

| Donn√©e | Amateur | Influencer | Producer |
|--------|---------|------------|----------|
| Total reviews | ‚úÖ | ‚úÖ | ‚úÖ |
| Reviews par type | ‚ùå | ‚úÖ | ‚úÖ |
| Engagement (likes/vues) | ‚ùå | ‚úÖ | ‚úÖ |
| Top cultivars | ‚ùå | ‚ùå | ‚úÖ |
| Rendements cultures | ‚ùå | ‚ùå | ‚úÖ |
| Exports par format | ‚ùå | ‚úÖ | ‚úÖ |
| Graphiques √©volution | ‚ùå | ‚úÖ | ‚úÖ |

---

## Impl√©mentation Technique

### Mod√®le Prisma User (simplification)

**Champ `roles` actuel :**
```json
{"roles": ["consumer"]}
{"roles": ["influencer_basic"]}
{"roles": ["influencer_pro"]}
{"roles": ["producer"]}
{"roles": ["beta_tester"]}
```

**Nouveaux r√¥les (post-migration) :**
```json
{"roles": ["amateur"]}          // Consumer
{"roles": ["influencer"]}       // Influencer Basic/Pro fusionn√©s
{"roles": ["producer"]}         // Producer + Merchant
{"roles": ["beta_tester"]}      // Conserv√© temporairement
```

**Nouveaux champs Prisma √† ajouter (optionnel) :**
```prisma
model User {
  // ... champs existants
  
  // Abonnement (pour Influencer/Producer)
  subscriptionType    String?   @default(null)  // "influencer", "producer"
  subscriptionStart   DateTime?
  subscriptionEnd     DateTime?
  subscriptionStatus  String?   @default("inactive")  // "active", "cancelled", "expired"
  
  // Limites quotidiennes
  dailyExportsUsed    Int       @default(0)
  dailyExportsReset   DateTime  @default(now())
}
```

### Service account.js ‚Äî Nouvelles constantes

```javascript
export const ACCOUNT_TYPES = {
    BETA_TESTER: 'beta_tester',    // Temporaire (acc√®s complet)
    AMATEUR: 'amateur',            // Gratuit (restrictions)
    INFLUENCER: 'influencer',      // 15.99‚Ç¨/mois
    PRODUCER: 'producer',          // 29.99‚Ç¨/mois
};

export const EXPORT_LIMITS = {
    AMATEUR: { daily: 3, templates: 3, watermarks: 1, reviews: 10 },
    INFLUENCER: { daily: 50, templates: 20, watermarks: 5, reviews: 100 },
    PRODUCER: { daily: -1, templates: -1, watermarks: -1, reviews: -1 },  // -1 = illimit√©
};

export const EXPORT_FORMATS = {
    AMATEUR: ['png', 'jpeg', 'pdf'],  // 150dpi
    INFLUENCER: ['png', 'jpeg', 'pdf', 'svg'],  // 300dpi
    PRODUCER: ['png', 'jpeg', 'pdf', 'svg', 'csv', 'json', 'html', 'gif'],  // 300dpi
};

export const EXPORT_DPI = {
    AMATEUR: 150,
    INFLUENCER: 300,
    PRODUCER: 300,
};
```

### Middleware permissions.js (nouveau)

```javascript
/**
 * V√©rifie si utilisateur peut acc√©der √† une fonctionnalit√©
 * @param {Object} user - User Prisma
 * @param {string} feature - Nom de la feature
 * @param {Object} options - Options suppl√©mentaires
 * @returns {Object} { allowed: boolean, reason?: string, limit?: number }
 */
export function canAccessFeature(user, feature, options = {}) {
    const accountType = getUserAccountType(user);
    
    switch(feature) {
        case 'template_custom':
            return accountType === ACCOUNT_TYPES.PRODUCER 
                ? { allowed: true }
                : { allowed: false, reason: 'R√©serv√© aux Producteurs' };
        
        case 'export_high_quality':
            return [ACCOUNT_TYPES.INFLUENCER, ACCOUNT_TYPES.PRODUCER].includes(accountType)
                ? { allowed: true }
                : { allowed: false, reason: 'Abonnement Influencer ou Producer requis' };
        
        case 'export_format':
            const allowedFormats = EXPORT_FORMATS[accountType] || EXPORT_FORMATS.AMATEUR;
            const requestedFormat = options.format;
            
            if (!allowedFormats.includes(requestedFormat)) {
                return { 
                    allowed: false, 
                    reason: `Format ${requestedFormat} non disponible pour ${accountType}`,
                    allowedFormats 
                };
            }
            return { allowed: true, allowedFormats };
        
        case 'pipeline_culture':
        case 'genetics_canvas':
            return accountType === ACCOUNT_TYPES.PRODUCER
                ? { allowed: true }
                : { allowed: false, reason: 'R√©serv√© aux Producteurs' };
        
        case 'library_templates':
            const limits = EXPORT_LIMITS[accountType] || EXPORT_LIMITS.AMATEUR;
            const currentCount = options.currentCount || 0;
            
            if (limits.templates === -1) {
                return { allowed: true, limit: -1 };
            }
            
            if (currentCount >= limits.templates) {
                return { 
                    allowed: false, 
                    reason: `Limite de ${limits.templates} templates atteinte`,
                    limit: limits.templates 
                };
            }
            
            return { allowed: true, limit: limits.templates };
        
        case 'daily_exports':
            const exportLimits = EXPORT_LIMITS[accountType] || EXPORT_LIMITS.AMATEUR;
            const todayExports = options.todayCount || 0;
            
            if (exportLimits.daily === -1) {
                return { allowed: true, limit: -1 };
            }
            
            if (todayExports >= exportLimits.daily) {
                return { 
                    allowed: false, 
                    reason: `Limite quotidienne de ${exportLimits.daily} exports atteinte`,
                    limit: exportLimits.daily 
                };
            }
            
            return { allowed: true, limit: exportLimits.daily };
        
        case 'stats_advanced':
            return [ACCOUNT_TYPES.INFLUENCER, ACCOUNT_TYPES.PRODUCER].includes(accountType)
                ? { allowed: true }
                : { allowed: false, reason: 'Statistiques avanc√©es r√©serv√©es aux abonn√©s' };
        
        default:
            return { allowed: false, reason: 'Feature inconnue' };
    }
}

/**
 * Middleware Express pour v√©rifier permissions
 */
export function requireFeature(feature, optionsGetter = null) {
    return async (req, res, next) => {
        if (!req.user) {
            return res.status(401).json({ error: 'authentication_required' });
        }
        
        const options = typeof optionsGetter === 'function' 
            ? await optionsGetter(req) 
            : {};
        
        const check = canAccessFeature(req.user, feature, options);
        
        if (!check.allowed) {
            return res.status(403).json({ 
                error: 'feature_restricted',
                message: check.reason,
                accountType: getUserAccountType(req.user),
                upgradeRequired: feature.includes('_') 
                    ? feature.split('_')[0] 
                    : null
            });
        }
        
        req.featureCheck = check;
        next();
    };
}
```

---

## Migration Base de Donn√©es

### Migration SQL `004_simplify_account_types.sql`

```sql
-- Migration simplification types de comptes
-- Reviews-Maker 2025-12-12

-- √âtape 1: Ajouter nouveaux champs abonnement
ALTER TABLE users ADD COLUMN subscriptionType TEXT DEFAULT NULL;
ALTER TABLE users ADD COLUMN subscriptionStart TEXT DEFAULT NULL;
ALTER TABLE users ADD COLUMN subscriptionEnd TEXT DEFAULT NULL;
ALTER TABLE users ADD COLUMN subscriptionStatus TEXT DEFAULT 'inactive';
ALTER TABLE users ADD COLUMN dailyExportsUsed INTEGER DEFAULT 0;
ALTER TABLE users ADD COLUMN dailyExportsReset TEXT DEFAULT CURRENT_TIMESTAMP;

-- √âtape 2: Cr√©er index pour performances
CREATE INDEX IF NOT EXISTS idx_users_subscription ON users(subscriptionType, subscriptionStatus);
CREATE INDEX IF NOT EXISTS idx_users_daily_exports ON users(dailyExportsReset);

-- √âtape 3: Migration donn√©es (script Node.js requis pour JSON parsing)
-- Voir server-new/scripts/migrate-account-types.js

-- √âtape 4: Mise √† jour timestamps
UPDATE users SET updatedAt = CURRENT_TIMESTAMP WHERE subscriptionType IS NOT NULL;
```

### Script Migration Node.js `migrate-account-types.js`

```javascript
import { PrismaClient } from '@prisma/client';
const prisma = new PrismaClient();

async function migrateAccountTypes() {
    console.log('üîÑ Migration types de comptes...\n');
    
    const users = await prisma.user.findMany();
    let migrated = { amateur: 0, influencer: 0, producer: 0, beta: 0 };
    
    for (const user of users) {
        let roles;
        try {
            roles = JSON.parse(user.roles).roles || [];
        } catch {
            roles = ['consumer'];
        }
        
        let newRoles = [];
        let subType = null;
        let subStatus = 'inactive';
        
        // Mapping ancien -> nouveau
        if (roles.includes('beta_tester')) {
            newRoles = ['beta_tester'];
            migrated.beta++;
        }
        else if (roles.includes('producer') || roles.includes('merchant')) {
            newRoles = ['producer'];
            subType = 'producer';
            subStatus = 'active';
            migrated.producer++;
        }
        else if (roles.includes('influencer_pro') || roles.includes('influencer_basic')) {
            newRoles = ['influencer'];
            subType = 'influencer';
            subStatus = 'active';
            migrated.influencer++;
        }
        else {
            newRoles = ['amateur'];
            migrated.amateur++;
        }
        
        await prisma.user.update({
            where: { id: user.id },
            data: {
                roles: JSON.stringify({ roles: newRoles }),
                subscriptionType: subType,
                subscriptionStatus: subStatus,
                subscriptionStart: subType ? new Date() : null,
            }
        });
    }
    
    console.log('‚úÖ Migration termin√©e :');
    console.log(`   - Amateur: ${migrated.amateur}`);
    console.log(`   - Influencer: ${migrated.influencer}`);
    console.log(`   - Producer: ${migrated.producer}`);
    console.log(`   - Beta Tester: ${migrated.beta}`);
    console.log(`   - Total: ${users.length}\n`);
}

migrateAccountTypes()
    .catch(console.error)
    .finally(() => prisma.$disconnect());
```

---

## Endpoints API Modifi√©s

### Routes √† prot√©ger avec `requireFeature`

**`/api/templates` (POST personnalis√©) :**
```javascript
router.post('/', requireAuth, requireFeature('template_custom'), async (req, res) => {
    // Cr√©ation template personnalis√© (drag & drop)
});
```

**`/api/export` (format/qualit√©) :**
```javascript
router.post('/render', requireAuth, async (req, res) => {
    const { format, dpi } = req.body;
    
    // V√©rifier format autoris√©
    const formatCheck = canAccessFeature(req.user, 'export_format', { format });
    if (!formatCheck.allowed) {
        return res.status(403).json({ 
            error: 'format_restricted',
            message: formatCheck.reason,
            allowedFormats: formatCheck.allowedFormats
        });
    }
    
    // V√©rifier limite quotidienne
    const exportCheck = canAccessFeature(req.user, 'daily_exports', { 
        todayCount: await getTodayExportsCount(req.user.id) 
    });
    if (!exportCheck.allowed) {
        return res.status(429).json({
            error: 'export_limit_reached',
            message: exportCheck.reason,
            limit: exportCheck.limit
        });
    }
    
    // Appliquer DPI selon type compte
    const accountType = getUserAccountType(req.user);
    const maxDpi = EXPORT_DPI[accountType];
    const finalDpi = Math.min(dpi || 150, maxDpi);
    
    // ... render avec finalDpi
});
```

**`/api/library/templates` (limite) :**
```javascript
router.post('/', requireAuth, async (req, res) => {
    const currentCount = await prisma.savedTemplate.count({
        where: { userId: req.user.id }
    });
    
    const check = canAccessFeature(req.user, 'library_templates', { currentCount });
    if (!check.allowed) {
        return res.status(403).json({ 
            error: 'library_limit_reached',
            message: check.reason,
            limit: check.limit,
            current: currentCount
        });
    }
    
    // ... cr√©er template
});
```

**`/api/stats` (avanc√©) :**
```javascript
router.get('/engagement', requireAuth, requireFeature('stats_advanced'), async (req, res) => {
    // Statistiques engagement d√©taill√©es
});
```

---

## Frontend React ‚Äî Composants Cl√©s

### AccountTypeSelector.jsx (inscription)

```jsx
import React, { useState } from 'react';
import './AccountTypeSelector.css';

const ACCOUNT_TIERS = [
    {
        type: 'amateur',
        name: 'Amateur',
        price: 'Gratuit',
        color: '#8B5CF6',
        features: [
            'Reviews illimit√©es',
            'Templates pr√©d√©finis (3)',
            'Export PNG/JPEG/PDF (150dpi)',
            '3 exports/jour',
            'Biblioth√®que limit√©e (10 items)'
        ],
        limitations: [
            'Filigrane syst√®me obligatoire',
            'Pas de templates personnalis√©s',
            'Pas de statistiques avanc√©es'
        ]
    },
    {
        type: 'influencer',
        name: 'Influencer',
        price: '15.99‚Ç¨/mois',
        color: '#10B981',
        recommended: true,
        features: [
            'Tout de Amateur',
            'Templates personnalis√©s',
            'Export haute qualit√© (300dpi + SVG)',
            '50 exports/jour',
            'Biblioth√®que √©tendue (100 items)',
            'Statistiques avanc√©es',
            'Badge v√©rifi√©',
            'Partage r√©seaux sociaux'
        ],
        limitations: [
            'Pas de pipelines culture',
            'Pas de g√©n√©tique canvas'
        ]
    },
    {
        type: 'producer',
        name: 'Producteur',
        price: '29.99‚Ç¨/mois',
        color: '#F59E0B',
        features: [
            'Tout de Influencer',
            'Pipelines culture configurables',
            'G√©n√©tique canvas (arbre)',
            'Export GIF (timeline)',
            'Export CSV/JSON/HTML',
            'Exports illimit√©s',
            'Biblioth√®que illimit√©e',
            'Branding entreprise',
            'Badge Producteur Certifi√©'
        ],
        limitations: []
    }
];

export default function AccountTypeSelector({ onSelect }) {
    const [selected, setSelected] = useState('amateur');
    
    const handleSelect = (type) => {
        setSelected(type);
        onSelect(type);
    };
    
    return (
        <div className="account-type-selector">
            <h2 className="selector-title">Choisissez votre type de compte</h2>
            <p className="selector-subtitle">
                S√©lectionnez l'offre qui correspond √† vos besoins
            </p>
            
            <div className="tiers-grid">
                {ACCOUNT_TIERS.map(tier => (
                    <div 
                        key={tier.type}
                        className={`tier-card ${selected === tier.type ? 'selected' : ''} ${tier.recommended ? 'recommended' : ''}`}
                        onClick={() => handleSelect(tier.type)}
                        style={{ '--tier-color': tier.color }}
                    >
                        {tier.recommended && (
                            <div className="recommended-badge">Recommand√©</div>
                        )}
                        
                        <div className="tier-header">
                            <h3 className="tier-name">{tier.name}</h3>
                            <div className="tier-price">{tier.price}</div>
                        </div>
                        
                        <div className="tier-features">
                            <h4>Fonctionnalit√©s :</h4>
                            <ul>
                                {tier.features.map((feature, i) => (
                                    <li key={i}>
                                        <span className="icon">‚úì</span> {feature}
                                    </li>
                                ))}
                            </ul>
                            
                            {tier.limitations.length > 0 && (
                                <>
                                    <h4 className="limitations-title">Limitations :</h4>
                                    <ul className="limitations">
                                        {tier.limitations.map((limit, i) => (
                                            <li key={i}>
                                                <span className="icon">‚úó</span> {limit}
                                            </li>
                                        ))}
                                    </ul>
                                </>
                            )}
                        </div>
                        
                        <button 
                            className={`tier-button ${selected === tier.type ? 'selected' : ''}`}
                            onClick={(e) => {
                                e.stopPropagation();
                                handleSelect(tier.type);
                            }}
                        >
                            {selected === tier.type ? 'S√©lectionn√©' : 'Choisir'}
                        </button>
                    </div>
                ))}
            </div>
        </div>
    );
}
```

### AccountTypeSelector.css (Liquid Glass)

```css
.account-type-selector {
    max-width: 1400px;
    margin: 0 auto;
    padding: 40px 20px;
}

.selector-title {
    font-size: 32px;
    font-weight: 700;
    text-align: center;
    margin-bottom: 10px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.selector-subtitle {
    text-align: center;
    color: #6b7280;
    margin-bottom: 40px;
}

.tiers-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 30px;
    max-width: 1200px;
    margin: 0 auto;
}

.tier-card {
    position: relative;
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 20px;
    padding: 30px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

.tier-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 48px rgba(0, 0, 0, 0.15);
    border-color: var(--tier-color);
}

.tier-card.selected {
    border-width: 2px;
    border-color: var(--tier-color);
    box-shadow: 0 0 0 3px rgba(var(--tier-color), 0.1);
}

.tier-card.recommended {
    border-color: #10B981;
    background: rgba(16, 185, 129, 0.05);
}

.recommended-badge {
    position: absolute;
    top: -12px;
    right: 20px;
    background: linear-gradient(135deg, #10B981, #059669);
    color: white;
    padding: 6px 16px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
}

.tier-header {
    margin-bottom: 24px;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding-bottom: 20px;
}

.tier-name {
    font-size: 24px;
    font-weight: 700;
    color: var(--tier-color);
    margin-bottom: 8px;
}

.tier-price {
    font-size: 28px;
    font-weight: 800;
    color: #1f2937;
}

.tier-features h4 {
    font-size: 14px;
    font-weight: 600;
    color: #6b7280;
    margin: 20px 0 12px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.tier-features ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

.tier-features li {
    padding: 8px 0;
    display: flex;
    align-items: flex-start;
    gap: 10px;
    font-size: 14px;
    color: #374151;
}

.tier-features .icon {
    flex-shrink: 0;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: var(--tier-color);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: 700;
}

.limitations-title {
    color: #ef4444 !important;
}

.limitations li {
    color: #6b7280;
}

.limitations .icon {
    background: #ef4444;
}

.tier-button {
    width: 100%;
    padding: 14px 24px;
    border: 2px solid var(--tier-color);
    background: white;
    color: var(--tier-color);
    border-radius: 12px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-top: 24px;
}

.tier-button:hover {
    background: var(--tier-color);
    color: white;
    transform: scale(1.02);
}

.tier-button.selected {
    background: var(--tier-color);
    color: white;
    box-shadow: 0 4px 12px rgba(var(--tier-color), 0.3);
}

/* Dark mode */
@media (prefers-color-scheme: dark) {
    .tier-card {
        background: rgba(31, 41, 55, 0.7);
        border-color: rgba(255, 255, 255, 0.1);
    }
    
    .tier-price {
        color: #f9fafb;
    }
    
    .tier-features li {
        color: #d1d5db;
    }
    
    .tier-button {
        background: rgba(31, 41, 55, 0.5);
    }
}
```

---

## Prochaines √âtapes

1. ‚úÖ **Documentation matrice restrictions** (ce fichier)
2. ‚è≥ **Cr√©er middleware `permissions.js`**
3. ‚è≥ **Migration Prisma schema** (nouveaux champs abonnement)
4. ‚è≥ **Script migration donn√©es** (`migrate-account-types.js`)
5. ‚è≥ **Prot√©ger routes API** (templates, export, library, stats)
6. ‚è≥ **Composant frontend** `AccountTypeSelector.jsx`
7. ‚è≥ **Tests d√©ploiement VPS**

---

## Notes Importantes

- **Beta Testers** conservent acc√®s complet temporairement
- **Migration r√©versible** : backup DB avant migration
- **Abonnements existants** : Influencer Pro downgrade vers Influencer (notification users)
- **Merchant** devient Producer automatiquement
- **Limites quotidiennes** : reset automatique via cron job ou middleware
- **Feature flags** : utiliser pour rollout progressif restrictions

---

**Derni√®re mise √† jour :** 2025-12-12  
**Auteur :** GitHub Copilot  
**Statut :** üìù Documentation initiale
