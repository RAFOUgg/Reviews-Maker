<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Auth - Reviews Maker</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a2e;
            color: #eee;
        }

        .section {
            background: #16213e;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 1px solid #0f3460;
        }

        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-weight: 600;
            margin-left: 10px;
        }

        .ok {
            background: #2d5;
            color: #000;
        }

        .error {
            background: #e53;
            color: #fff;
        }

        .warning {
            background: #fa3;
            color: #000;
        }

        button {
            background: #e94560;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }

        button:hover {
            background: #d93a54;
        }

        input {
            padding: 10px;
            width: 100%;
            margin: 10px 0;
            background: #0f3460;
            border: 1px solid #16213e;
            color: #eee;
            border-radius: 4px;
        }

        pre {
            background: #000;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>

<body>
    <h1>üîç Test Authentification</h1>

    <div class="section">
        <h2>1. √âtat localStorage</h2>
        <div id="storageStatus"></div>
        <button onclick="checkStorage()">üîÑ Rafra√Æchir</button>
        <button onclick="clearAuth()">üóëÔ∏è Effacer Auth</button>
    </div>

    <div class="section">
        <h2>2. Test Connexion Manuelle</h2>
        <input type="email" id="testEmail" placeholder="Email de test" value="test@lafoncedalle.fr">
        <input type="text" id="testToken" placeholder="Token de test" value="test-token-123">
        <button onclick="setTestAuth()">‚úì D√©finir Auth</button>
    </div>

    <div class="section">
        <h2>3. Test updateAuthUI()</h2>
        <div id="authUIStatus"></div>
        <button onclick="testUpdateAuthUI()">‚ñ∂Ô∏è Ex√©cuter updateAuthUI()</button>
    </div>

    <div class="section">
        <h2>4. Test Modal Compte</h2>
        <div id="modalStatus"></div>
        <button onclick="testOpenModal()">‚ñ∂Ô∏è Ouvrir Modal</button>
    </div>

    <div class="section">
        <h2>5. Logs</h2>
        <pre id="logs"></pre>
    </div>

    <script>
        function log(msg, type = 'info') {
            const logs = document.getElementById('logs');
            const time = new Date().toLocaleTimeString();
            logs.textContent += `[${time}] ${msg}\n`;
            logs.scrollTop = logs.scrollHeight;
            console.log(msg);
        }

        function checkStorage() {
            const token = localStorage.getItem('authToken');
            const email = localStorage.getItem('authEmail');
            const rmToken = localStorage.getItem('rm_authToken');
            const rmEmail = localStorage.getItem('rm_authEmail');

            let html = '<div>';
            html += `<div>authToken: ${token ? `<span class="status ok">PR√âSENT (${token.substring(0, 10)}...)</span>` : '<span class="status error">ABSENT</span>'}</div>`;
            html += `<div>authEmail: ${email ? `<span class="status ok">${email}</span>` : '<span class="status error">ABSENT</span>'}</div>`;

            if (rmToken) {
                html += `<div>rm_authToken: <span class="status warning">PR√âSENT (migr√©)</span></div>`;
            }
            if (rmEmail) {
                html += `<div>rm_authEmail: <span class="status warning">PR√âSENT (migr√©)</span></div>`;
            }

            html += '</div>';
            document.getElementById('storageStatus').innerHTML = html;

            log('‚úì Storage v√©rifi√©');
        }

        function clearAuth() {
            localStorage.removeItem('authToken');
            localStorage.removeItem('authEmail');
            localStorage.removeItem('discordUsername');
            localStorage.removeItem('discordId');
            localStorage.removeItem('rm_authToken');
            localStorage.removeItem('rm_authEmail');
            log('üóëÔ∏è Auth effac√©e');
            checkStorage();
        }

        function setTestAuth() {
            const email = document.getElementById('testEmail').value;
            const token = document.getElementById('testToken').value;

            localStorage.setItem('authEmail', email);
            localStorage.setItem('authToken', token);

            log(`‚úì Auth d√©finie: ${email}`);
            checkStorage();
        }

        function testUpdateAuthUI() {
            const status = document.getElementById('authUIStatus');

            // Test si la fonction existe
            if (typeof updateAuthUI !== 'function') {
                status.innerHTML = '<span class="status error">updateAuthUI() non disponible</span>';
                log('‚ùå updateAuthUI() non disponible');
                return;
            }

            status.innerHTML = '<span class="status warning">En cours...</span>';
            log('‚Üí Ex√©cution updateAuthUI()...');

            updateAuthUI().then(() => {
                const connected = typeof isUserConnected !== 'undefined' ? isUserConnected : 'undefined';
                status.innerHTML = `<span class="status ok">Termin√©</span><div>isUserConnected: ${connected}</div>`;
                log(`‚úì updateAuthUI() termin√© - isUserConnected: ${connected}`);
            }).catch(err => {
                status.innerHTML = `<span class="status error">Erreur: ${err.message}</span>`;
                log(`‚ùå Erreur: ${err.message}`);
            });
        }

        function testOpenModal() {
            const status = document.getElementById('modalStatus');

            if (typeof openAccountModal !== 'function') {
                status.innerHTML = '<span class="status error">openAccountModal() non disponible</span>';
                log('‚ùå openAccountModal() non disponible');
                return;
            }

            log('‚Üí Ouverture modal...');
            try {
                openAccountModal();
                status.innerHTML = '<span class="status ok">Modal ouvert (v√©rifie la page principale)</span>';
                log('‚úì openAccountModal() appel√©');
            } catch (err) {
                status.innerHTML = `<span class="status error">Erreur: ${err.message}</span>`;
                log(`‚ùå Erreur: ${err.message}`);
            }
        }

        // Init au chargement
        window.addEventListener('load', () => {
            log('=== Page de test charg√©e ===');
            checkStorage();
        });
    </script>
</body>

</html>