<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flower Canvas Renderer - Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #ffffff;
            padding: 40px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            font-size: 32px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #1f2937;
        }

        .subtitle {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 40px;
        }

        .layout {
            display: grid;
            grid-template-columns: 1fr 280px;
            gap: 40px;
            align-items: start;
        }

        canvas {
            width: 100%;
            height: auto;
            border-radius: 12px;
            background: white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .control-label {
            font-size: 13px;
            font-weight: 500;
            color: #374151;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .control-value {
            font-size: 13px;
            color: #9ca3af;
            font-weight: 600;
        }

        input[type="range"] {
            appearance: none;
            width: 100%;
            height: 4px;
            border-radius: 2px;
            background: #e5e7eb;
            outline: none;
            -webkit-appearance: none;
            cursor: pointer;
        }

        input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #2dd4bf;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(45, 212, 191, 0.2);
        }

        input[type="range"]::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #2dd4bf;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 4px rgba(45, 212, 191, 0.2);
        }

        .info {
            margin-top: 40px;
            padding: 20px;
            background: #f3f4f6;
            border-radius: 8px;
            font-size: 13px;
            color: #4b5563;
            line-height: 1.6;
        }

        .info strong {
            color: #1f2937;
        }

        .fps {
            font-size: 12px;
            color: #9ca3af;
            margin-top: 16px;
            text-align: center;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üåø Flower Canvas Renderer</h1>
        <p class="subtitle">Interactive 60fps Canvas 2D visualization with 6 parameters</p>

        <div class="layout">
            <canvas id="flowerCanvas" width="600" height="500"></canvas>

            <div class="controls">
                <div class="control-group">
                    <div class="control-label">
                        <span>Densit√©</span>
                        <span class="control-value" id="val-densite">5.0</span>
                    </div>
                    <input type="range" id="slider-densite" min="0" max="10" step="0.1" value="5">
                </div>

                <div class="control-group">
                    <div class="control-label">
                        <span>Trichomes</span>
                        <span class="control-value" id="val-trichomes">5.0</span>
                    </div>
                    <input type="range" id="slider-trichomes" min="0" max="10" step="0.1" value="5">
                </div>

                <div class="control-group">
                    <div class="control-label">
                        <span>Pistils</span>
                        <span class="control-value" id="val-pistils">5.0</span>
                    </div>
                    <input type="range" id="slider-pistils" min="0" max="10" step="0.1" value="5">
                </div>

                <div class="control-group">
                    <div class="control-label">
                        <span>Manucure</span>
                        <span class="control-value" id="val-manucure">5.0</span>
                    </div>
                    <input type="range" id="slider-manucure" min="0" max="10" step="0.1" value="5">
                </div>

                <div class="control-group">
                    <div class="control-label">
                        <span>Moisissure</span>
                        <span class="control-value" id="val-moisissure">10.0</span>
                    </div>
                    <input type="range" id="slider-moisissure" min="0" max="10" step="0.1" value="10">
                </div>

                <div class="control-group">
                    <div class="control-label">
                        <span>Graines</span>
                        <span class="control-value" id="val-graines">10.0</span>
                    </div>
                    <input type="range" id="slider-graines" min="0" max="10" step="0.1" value="10">
                </div>

                <div class="fps" id="fps">-- fps</div>
            </div>
        </div>

        <div class="info">
            <strong>√Ä propos:</strong> Cette visualisation utilise Canvas 2D native pour un rendu haute performance.
            Les 6 param√®tres contr√¥lent l'aspect de la fleur en temps r√©el √† 60fps avec morphing lisse.
            Code vanilla JS, z√©ro d√©pendances externes.
        </div>
    </div>

    <script>
        const canvas = document.getElementById('flowerCanvas');
        const ctx = canvas.getContext('2d');
        let params = {
            densite: 5,
            trichomes: 5,
            pistils: 5,
            manucure: 5,
            moisissure: 10,
            graines: 10
        };

        // Setup sliders
        Object.keys(params).forEach(key => {
            const slider = document.getElementById(`slider-${key}`);
            const valueDisplay = document.getElementById(`val-${key}`);

            slider.addEventListener('input', (e) => {
                params[key] = parseFloat(e.target.value);
                valueDisplay.textContent = params[key].toFixed(1);
            });
        });

        // Renderer
        const renderer = {
            colors: {
                light_green: '#A3E635',
                green: '#22C55E',
                dark_green: '#16A34A',
                darker_green: '#15803D',
                pistol_orange: '#EA580C',
                trichome_white: '#FFFFFF',
                shadow: 'rgba(0,0,0,0.15)',
                mold_gray: '#8B8680',
                seed_green: '#6B7280'
            },

            seededRandom: (seed) => {
                const x = Math.sin(seed) * 10000;
                return x - Math.floor(x);
            },

            drawSepal: (cx, cy, rx, ry, rotation) => {
                ctx.save();
                ctx.translate(cx, cy);
                ctx.rotate(rotation);

                const grad = ctx.createRadialGradient(-rx * 0.3, -ry * 0.3, 0, 0, 0, rx * 1.2);
                grad.addColorStop(0, renderer.colors.light_green);
                grad.addColorStop(0.6, renderer.colors.green);
                grad.addColorStop(1, renderer.colors.dark_green);

                ctx.fillStyle = grad;
                ctx.beginPath();
                ctx.ellipse(0, 0, rx, ry, 0, 0, Math.PI * 2);
                ctx.fill();

                ctx.strokeStyle = renderer.colors.darker_green;
                ctx.lineWidth = 0.5;
                ctx.stroke();

                ctx.restore();
            },

            drawPistils: (cx, cy, density) => {
                const count = Math.round(density * 20);
                ctx.strokeStyle = renderer.colors.pistol_orange;
                ctx.globalAlpha = 0.6 + (density / 10) * 0.4;
                ctx.lineWidth = 0.8 + (density / 10) * 1.5;
                ctx.lineCap = 'round';

                for (let i = 0; i < count; i++) {
                    const angle = (i / count) * Math.PI * 2 + Math.sin(i * 0.5) * 0.3;
                    const length = 15 + Math.random() * 20;
                    const curve = Math.sin(i * 0.7) * 8;

                    ctx.beginPath();
                    ctx.moveTo(cx, cy);

                    const cpx = cx + Math.cos(angle) * length * 0.4 + curve;
                    const cpy = cy + Math.sin(angle) * length * 0.4;
                    const endX = cx + Math.cos(angle) * length;
                    const endY = cy + Math.sin(angle) * length * 0.6;

                    ctx.quadraticCurveTo(cpx, cpy, endX, endY);
                    ctx.stroke();
                }

                ctx.globalAlpha = 1;
            },

            drawTrichomes: () => {
                const density = params.trichomes;
                if (density === 0) return;

                const count = Math.round(density * 80);
                ctx.globalAlpha = 0.6 + (density / 10) * 0.4;
                ctx.fillStyle = renderer.colors.trichome_white;
                ctx.shadowColor = 'rgba(255,255,255,0.8)';
                ctx.shadowBlur = 2 + density * 0.5;

                for (let i = 0; i < count; i++) {
                    const seed = i * 137.5;
                    const angle = seed * 0.1;
                    const radius = 30 + Math.sin(seed * 0.01) * 50;
                    const x = 300 + Math.cos(angle) * radius;
                    const y = 200 + Math.sin(angle) * radius * 0.7;

                    const r = 0.5 + renderer.seededRandom(seed) * 1.5;
                    ctx.beginPath();
                    ctx.arc(x, y, r, 0, Math.PI * 2);
                    ctx.fill();
                }

                ctx.shadowColor = 'transparent';
                ctx.globalAlpha = 1;
            },

            drawLeaves: () => {
                const leafCount = Math.max(0, Math.round((1 - params.manucure / 10) * 6));
                ctx.fillStyle = renderer.colors.light_green;
                ctx.strokeStyle = renderer.colors.green;
                ctx.lineWidth = 0.7;
                ctx.globalAlpha = 0.7;

                for (let i = 0; i < leafCount; i++) {
                    const angle = (i / Math.max(1, leafCount - 1)) * 120 - 60 + Math.PI;
                    const length = 60 + Math.sin(i * 0.5) * 15;

                    ctx.save();
                    ctx.translate(300, 200);
                    ctx.rotate(angle);

                    ctx.beginPath();
                    for (let j = 0; j <= 5; j++) {
                        const t = j / 5;
                        const x = length * t;
                        const y = Math.sin(t * Math.PI) * (8 + i * 2) * (j % 2 === 0 ? 1 : -1);
                        if (j === 0) ctx.moveTo(x, y);
                        else ctx.lineTo(x, y);
                    }
                    ctx.fill();
                    ctx.stroke();

                    ctx.restore();
                }

                ctx.globalAlpha = 1;
            },

            drawMold: () => {
                const moldIntensity = 1 - (params.moisissure / 10);
                if (moldIntensity < 0.01) return;

                ctx.globalAlpha = moldIntensity * 0.5;
                ctx.fillStyle = renderer.colors.mold_gray;

                for (let i = 0; i < 20; i++) {
                    const angle = i * Math.PI * 2 / 20;
                    const radius = 20 + Math.sin(i * 0.5) * 25;
                    const x = 300 + Math.cos(angle) * radius;
                    const y = 200 + Math.sin(angle) * radius * 0.6;

                    ctx.beginPath();
                    ctx.arc(x, y, 2 + Math.random() * 3, 0, Math.PI * 2);
                    ctx.fill();
                }

                ctx.globalAlpha = 1;
            },

            drawSeeds: () => {
                const seedCount = Math.max(0, Math.round((1 - params.graines / 10) * 8));
                ctx.fillStyle = renderer.colors.seed_green;
                ctx.globalAlpha = 0.6;

                for (let i = 0; i < seedCount; i++) {
                    const angle = i * Math.PI * 2 / seedCount;
                    const radius = 35 + Math.sin(i * 0.8) * 15;
                    const x = 300 + Math.cos(angle) * radius;
                    const y = 200 + Math.sin(angle) * radius * 0.7;

                    ctx.beginPath();
                    ctx.ellipse(x, y, 4, 6, angle, 0, Math.PI * 2);
                    ctx.fill();
                }

                ctx.globalAlpha = 1;
            },

            drawStructure: () => {
                const density = params.densite / 10;
                const gap = 1 + (1 - density) * 3;
                const layers = 7;

                let colorIdx = 0;
                for (let layer = 0; layer < layers; layer++) {
                    const layerRadius = 50 - layer * (4 + gap * 1.5);
                    const layerY = 200 + layer * (8 + gap * 2);
                    const sepsCount = Math.max(3, Math.round(10 - layer * 1.2));
                    const sizeMultiplier = 1 - layer * 0.12;

                    for (let i = 0; i < sepsCount; i++) {
                        const angle = (i / sepsCount) * Math.PI * 2 + layer * 0.3;
                        const x = 300 + Math.cos(angle) * layerRadius;
                        const y = layerY + Math.sin(angle) * layerRadius * 0.5;

                        const rx = 10 * sizeMultiplier * (1 + Math.sin(angle * 3) * 0.15);
                        const ry = 15 * sizeMultiplier * (1 + Math.cos(angle * 2) * 0.12);
                        const rotation = angle + Math.PI / 2;

                        renderer.drawSepal(x, y, rx, ry, rotation);
                        colorIdx++;
                    }
                }
            },

            drawShadow: () => {
                ctx.fillStyle = renderer.colors.shadow;
                ctx.globalAlpha = 0.3;
                ctx.beginPath();
                ctx.ellipse(300, 350, 80, 15, 0, 0, Math.PI * 2);
                ctx.fill();
                ctx.globalAlpha = 1;
            },

            drawStem: () => {
                ctx.fillStyle = renderer.colors.darker_green;
                ctx.globalAlpha = 0.6;
                ctx.fillRect(295, 300, 10, 80);
                ctx.globalAlpha = 1;
            },

            draw: () => {
                ctx.fillStyle = '#FFFFFF';
                ctx.fillRect(0, 0, 600, 500);

                renderer.drawShadow();
                renderer.drawStem();
                renderer.drawStructure();
                renderer.drawLeaves();
                renderer.drawMold();
                renderer.drawSeeds();
                renderer.drawPistils(300, 200, params.pistils / 10);
                renderer.drawTrichomes();
            }
        };

        // FPS counter
        let frameCount = 0;
        let lastTime = Date.now();

        const animate = () => {
            renderer.draw();

            frameCount++;
            const now = Date.now();
            if (now - lastTime >= 1000) {
                document.getElementById('fps').textContent = frameCount + ' fps';
                frameCount = 0;
                lastTime = now;
            }

            requestAnimationFrame(animate);
        };

        animate();
    </script>
</body>

</html>