<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <title>Test Library Modal</title>
    <style>
        body {
            font-family: system-ui;
            padding: 20px;
            background: #1a1a2e;
            color: #eee;
        }

        button {
            background: #4ecca3;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-weight: 600;
        }

        .result {
            margin-top: 20px;
            padding: 15px;
            background: #16213e;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>

<body>
    <h1>üîç Test Library Modal</h1>

    <button onclick="testElements()">1. V√©rifier √âl√©ments DOM</button>
    <button onclick="testOpenModal()">2. Tester openLibraryModal()</button>
    <button onclick="testDirectOpen()">3. Ouvrir Modal Directement</button>

    <div id="result" class="result">Cliquez sur un bouton pour tester...</div>

    <script src="scripts/logger.js"></script>
    <script src="src/storage-manager.js"></script>
    <script src="app.js"></script>

    <script>
        function log(msg) {
            document.getElementById('result').textContent = msg;
            console.log(msg);
        }

        function testElements() {
            let msg = 'üîç V√©rification des √©l√©ments DOM:\n\n';

            const elements = {
                'libraryModal': document.getElementById('libraryModal'),
                'libraryModalOverlay': document.getElementById('libraryModalOverlay'),
                'libraryDrawer': document.getElementById('libraryDrawer'),
                'openLibrary': document.getElementById('openLibrary'),
                'openLibraryFromAccount': document.getElementById('openLibraryFromAccount'),
                'libraryGrid': document.getElementById('libraryGrid'),
                'libraryList': document.getElementById('libraryList')
            };

            Object.keys(elements).forEach(key => {
                const el = elements[key];
                msg += `${key}: ${el ? '‚úÖ Existe' : '‚ùå Manquant'}`;
                if (el) {
                    msg += ` (display: ${el.style.display || 'default'})`;
                }
                msg += '\n';
            });

            msg += '\nüîç Variables globales:\n';
            msg += `dom object: ${typeof dom !== 'undefined' ? '‚úÖ' : '‚ùå'}\n`;
            if (typeof dom !== 'undefined') {
                msg += `dom.libraryModal: ${!!dom.libraryModal}\n`;
                msg += `dom.libraryDrawer: ${!!dom.libraryDrawer}\n`;
            }
            msg += `openLibraryModal function: ${typeof openLibraryModal !== 'undefined' ? '‚úÖ' : '‚ùå'}\n`;

            log(msg);
        }

        function testOpenModal() {
            log('üîç Tentative d\'ouverture via openLibraryModal()...\n');

            if (typeof openLibraryModal === 'undefined') {
                log('‚ùå ERREUR: openLibraryModal() non d√©finie!');
                return;
            }

            try {
                console.clear();
                openLibraryModal('mine', { fromAccount: true });

                setTimeout(() => {
                    const modal = document.getElementById('libraryModal');
                    let msg = '‚úÖ openLibraryModal() appel√©e\n\n';
                    msg += '√âtat du modal apr√®s appel:\n';
                    msg += `display: ${modal ? modal.style.display : 'modal introuvable'}\n`;
                    msg += `visible: ${modal && modal.style.display === 'flex' ? '‚úÖ OUI' : '‚ùå NON'}\n\n`;
                    msg += 'V√©rifiez la console pour les logs de debug.';
                    log(msg);
                }, 500);
            } catch (err) {
                log(`‚ùå ERREUR: ${err.message}\n${err.stack}`);
            }
        }

        function testDirectOpen() {
            log('üîç Ouverture directe du modal (force display)...\n');

            const modal = document.getElementById('libraryModal');
            if (!modal) {
                log('‚ùå libraryModal introuvable!');
                return;
            }

            modal.style.display = 'flex';

            let msg = '‚úÖ Modal ouvert en force\n\n';
            msg += `display: ${modal.style.display}\n`;
            msg += '\nSi vous ne voyez rien, v√©rifiez:\n';
            msg += '- Les styles CSS du modal\n';
            msg += '- Le z-index\n';
            msg += '- La pr√©sence de contenu dans le modal';

            log(msg);
        }

        // Auto-test au chargement
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(testElements, 1000);
        });
    </script>
</body>

</html>